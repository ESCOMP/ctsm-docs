

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.7.5. Adding PTCLM Site Data &#8212; clmdoc  documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.8. Troubleshooting" href="../trouble-shooting/index.html" />
    <link rel="prev" title="1.7.4. Examples of using PTCLM" href="ptclm-examples.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../trouble-shooting/index.html" title="1.8. Troubleshooting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ptclm-examples.html" title="1.7.4. Examples of using PTCLM"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. CLM User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">1.7. Running PTCLM</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.7.5. Adding PTCLM Site Data</a><ul>
<li><a class="reference internal" href="#dynamic-land-use-change-files-for-use-by-ptclm">1.7.5.1. Dynamic Land-Use Change Files for use by PTCLM</a></li>
<li><a class="reference internal" href="#converting-ameriflux-data-for-use-by-ptclm">1.7.5.2. Converting AmeriFlux Data for use by PTCLM</a></li>
<li><a class="reference internal" href="#example-ptclm-transient-example-over-a-shorter-time-period">1.7.5.3. Example: PTCLM transient example over a shorter time period</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ptclm-examples.html"
                        title="previous chapter">1.7.4. Examples of using PTCLM</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../trouble-shooting/index.html"
                        title="next chapter">1.8. Troubleshooting</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/users_guide/running-PTCLM/adding-ptclm-site-data.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="adding-ptclm-site-data">
<span id="id1"></span><h1>1.7.5. Adding PTCLM Site Data<a class="headerlink" href="#adding-ptclm-site-data" title="Permalink to this headline">¶</a></h1>
<p>The “sitegroupname” option to PTCLM1.110726 looks for groups of sites in the files in the <code class="docutils literal"><span class="pre">PTCLM_sitedata</span></code> directory under the PTCLM directory.
You can add new names available for this option including your own lists of sites, by adding more files in this directory.
There are three files for each “sitegroupname”: <code class="docutils literal"><span class="pre">$SITEGROUP_sitedata.txt</span></code>, <code class="docutils literal"><span class="pre">$SITEGROUP_soildata.txt</span></code> and <code class="docutils literal"><span class="pre">$SITEGROUP_pftdata.txt</span></code> (where <code class="docutils literal"><span class="pre">$SITEGROUP</span></code> is the name that would be entered as “sitegroupname” to PTCLM).
Each file needs to have the same list of sites, but gives different information: site data, PFT data, and soil data respectively.
Although the site codes need to be the same between the three files, the files do NOT have to be in the same order.
Each file has a one-line header that lists the contents of each column which are separated by commas.
The first column for each of the files is the “site_code” which must be consistent between the three files.
The site code can be any unique character string, but in general we use the AmeriFlux site code.</p>
<p>Site data file:`` $SITEGROUP_sitedata.txt``): The header for this file is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">site_code</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">elev</span><span class="p">,</span><span class="n">startyear</span><span class="p">,</span><span class="n">endyear</span><span class="p">,</span><span class="n">alignyear</span>
</pre></div>
</div>
<p>The columns: name, state, and elevation are informational only. Name is a longer descriptive name of the site, and state is the state for U.S. sites or country for non U.S. sites. The columns: lon and lat are the longitude and latitude of the location in decimal degrees. The last three columns are the start and ending year for the data and the align year for an 1850 case for the data. The align year is currently unused.</p>
<p>Soil data file: <code class="docutils literal"><span class="pre">$SITEGROUP_soildata.txt</span></code>): The header for this file is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">site_code</span><span class="p">,</span><span class="n">soil_depth</span><span class="p">,</span><span class="n">n_layers</span><span class="p">,</span><span class="n">layer_depth</span><span class="p">,</span><span class="n">layer_sand</span><span class="o">%</span><span class="p">,</span><span class="n">layer_clay</span><span class="o">%</span>
</pre></div>
</div>
<p>The first three fields after “site_code” are currently unused. The only two that are used are the percent sand and clay columns to set the soil texture.</p>
<p>PFT data file: <code class="docutils literal"><span class="pre">$SITEGROUP_pftdata.txt`</span></code>): The header for this file is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">site_code</span><span class="p">,</span><span class="n">pft_f1</span><span class="p">,</span><span class="n">pft_c1</span><span class="p">,</span><span class="n">pft_f2</span><span class="p">,</span><span class="n">pft_c2</span><span class="p">,</span><span class="n">pft_f3</span><span class="p">,</span><span class="n">pft_c3</span><span class="p">,</span><span class="n">pft_f4</span><span class="p">,</span><span class="n">pft_c4</span><span class="p">,</span><span class="n">pft_f5</span><span class="p">,</span><span class="n">pft_c5</span>
</pre></div>
</div>
<p>This file gives the vegetation coverage for the different vegetation types for the site. The file only supports up to five PFT’s at the same time. The columns with “pft_f” are the fractions for each PFT, and the columns with “pft_c” is the integer index of the given PFT. Look at the pft-physiology file to see what the PFT index for each PFT type is.</p>
<div class="section" id="dynamic-land-use-change-files-for-use-by-ptclm">
<h2>1.7.5.1. Dynamic Land-Use Change Files for use by PTCLM<a class="headerlink" href="#dynamic-land-use-change-files-for-use-by-ptclm" title="Permalink to this headline">¶</a></h2>
<p>There is a mechanism for giving site-specific land-use change in PTCLM. Adding site specific files to the <code class="docutils literal"><span class="pre">PTCLM_sitedata</span></code> directory under PTCLM allows you to specify the change in vegetation and change in harvesting (for the CN model) for that site. Files are named: <code class="docutils literal"><span class="pre">$SITE_dynpftdata.txt</span></code>. There is a sample file for the US-Ha1 site called: <code class="docutils literal"><span class="pre">US-Ha1_dynpftdata.txt</span></code>. The file has a one-line header with the information that the file has, and then one-line for each year with a transition. The header line is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">trans_year</span><span class="p">,</span><span class="n">pft_f1</span><span class="p">,</span><span class="n">pft_c1</span><span class="p">,</span><span class="n">pft_f2</span><span class="p">,</span><span class="n">pft_c2</span><span class="p">,</span><span class="n">pft_f3</span><span class="p">,</span><span class="n">pft_c3</span><span class="p">,</span><span class="n">pft_f4</span><span class="p">,</span><span class="n">pft_c4</span><span class="p">,</span><span class="n">pft_f5</span><span class="p">,</span><span class="n">pft_c5</span><span class="p">,</span><span class="n">har_vh1</span><span class="p">,</span><span class="n">har_vh2</span><span class="p">,</span><span class="n">har_sh1</span><span class="p">,</span><span class="n">har_sh2</span><span class="p">,</span><span class="n">har_sh3</span><span class="p">,</span><span class="n">graze</span><span class="p">,</span><span class="n">hold_harv</span><span class="p">,</span><span class="n">hold_graze</span>
</pre></div>
</div>
<p>This file only requires a line for each year where a transition or harvest happens. As in the “pftdata” file above “pft_f” refers to the fraction and “pft_c” refers to the PFT index, and only up to five vegetation types are allowed to co-exist. The last eight columns have to do with harvesting and grazing. The last two columns are whether to hold harvesting and/or grazing constant until the next transition year and will just be either 1 or 0. This file will be converted by the <strong>PTCLM_sitedata/cnvrt_trnsyrs2_pftdyntxtfile.pl</strong> script in the PTCLM directory to a format that <strong>mksurfdata_map</strong> can read that has an entry for each year for the range of years valid for the compset in question.</p>
</div>
<div class="section" id="converting-ameriflux-data-for-use-by-ptclm">
<h2>1.7.5.2. Converting AmeriFlux Data for use by PTCLM<a class="headerlink" href="#converting-ameriflux-data-for-use-by-ptclm" title="Permalink to this headline">¶</a></h2>
<p>AmeriFlux data comes in comma separated format and is available from:
<a class="reference external" href="http://public.ornl.gov/ameriflux/dataproducts.shtml">http://public.ornl.gov/ameriflux/dataproducts.shtml</a>. Before you download the data you need to agree to the usage terms.</p>
<p>Here is a copy of the usage terms from the web-site on June/13/2011.</p>
<p>“The AmeriFlux data provided on this site are freely available and were furnished by individual AmeriFlux scientists who encourage their use.
Please kindly inform the appropriate AmeriFlux scientist(s) of how you are using the data and of any publication plans.
Please acknowledge the data source as a citation or in the acknowledgments if the data are not yet published.
If the AmeriFlux Principal Investigators (PIs) feel that they should be acknowledged or offered participation as authors, they will let you know and we assume that an agreement on such matters will be reached before publishing and/or use of the data for publication.
If your work directly competes with the PI’s analysis they may ask that they have the opportunity to submit a manuscript before you submit one that uses unpublished data.
In addition, when publishing, please acknowledge the agency that supported the research.
Lastly, we kindly request that those publishing papers using AmeriFlux data provide preprints to the PIs providing the data and to the data archive at the Carbon Dioxide Information Analysis Center (CDIAC).”</p>
<p>The above agreement applies to the “US-UMB” dataset imported into our repository as well, and Gil Bohrer is the PI on record for that dataset.</p>
<p>The CESM can NOT handle missing data, so we recommend using the “Level 4” Gap filled datasets.
The fields will also need to be renamed.
The “WS” column becomes “WIND”, “PREC” becomes “PRECmms”, “RH” stays as “RH”, “TA” becomes “TBOT”, “Rg” becomes “FSDS”, “Rgl” becomes “FLDS”, “PRESS” becomes “PSRF”.
“ZBOT” can just be set to the constant of “30” (m).
The units of Temperature need to be converted from “Celsius” to “Kelvin” (use the value in <code class="docutils literal"><span class="pre">SHR_CONST_TKFRZ</span></code> in the file <code class="docutils literal"><span class="pre">models/csm_share/shr/shr_const.F90</span></code> of <code class="docutils literal"><span class="pre">273.15</span></code>.
The units of Pressure also need to be converted from “kPa” to “Pa”. LATIXY, and LONGXY should also be set to the latitude and longitude of the site.</p>
</div>
<div class="section" id="example-ptclm-transient-example-over-a-shorter-time-period">
<h2>1.7.5.3. Example: PTCLM transient example over a shorter time period<a class="headerlink" href="#example-ptclm-transient-example-over-a-shorter-time-period" title="Permalink to this headline">¶</a></h2>
<p>This is an example of using PTCLM for Harvard Forest (AmeriFlux site code US-Ha1) for transient land use 1991-2006.
In order to do this we would’ve needed to have converted the AmeriFlux data into NetCDF format as show in the <a class="reference external" href="CLM-URL">the Section called Converting AmeriFlux Data for use by PTCLM</a> section above.
Also note that this site has a site-specific dynamic land-use change file for it <code class="docutils literal"><span class="pre">PTCLM_sitedata/US-Ha1_dynpftdata.txt</span></code> in the PTCLM directory and this file will be used for land-use change and harvesting rather than the global dataset.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd scripts/ccsm_utils/Tools/lnd/clm/PTCLM
# We are going to use forcing data over 1991 to 2006, but we need to start with
# a transient compset to do so, so we use the 20th Century transient: 1850-2000
# Note: When creating the fpftdyn dataset for this site it will use the
#     PTCLM_sitedata/US-Ha1_dynpftdata.txt
# file for land-use change and harvesting
&gt; ./PTCLM.py -m yellowstone_intel -s US-Ha1 -d $MYCSMDATA --sitegroupname AmeriFlux -c I20TRCRUCLM45BGC
&gt; mkdir $MYCSMDATA/atm/datm7/CLM1PT_data/1x1pt_US-Ha1
&gt; cd $MYCSMDATA/atm/datm7/CLM1PT_data/1x1pt_US-Ha1
# Copy data in NetCDF format to this directory, filenames should be YYYY-MM.nc
# The fieldnames on the file should be:
#    FLDS,FSDS,LATIXY,   LONGXY,   PRECTmms,PSRF,RH,TBOT,WIND,ZBOT
# With units
#    W/m2,W/m2,degrees_N,degrees_E,mm/s,    Pa,  %, K,   m/s, m
# The time coordinate units should be: days since YYYY-MM-DD 00:00:00
&gt; cd ../../../../../US-Ha1_I20TRCRUCLM45BGC
# Now we need to set the start date to 1991, and make sure the align year is for 1991
&gt; ./xmlchange RUN_STARTDATE=1991-01-01,DATM_CLMNCEP_YR_ALIGN=1991
# Similarly for Nitrogen deposition data we cycle over: 1991 to 2006
&gt; cat &lt;&lt; EOF &gt;&gt; user_nl_clm
model_year_align_ndep=1991,stream_year_first_ndep=1991,stream_year_last_ndep=2006
EOF
# Now setup the case, and we&#39;ll edit the datm namelist for prescribed aerosols
&gt; ./cesm_setup
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../trouble-shooting/index.html" title="1.8. Troubleshooting"
             >next</a> |</li>
        <li class="right" >
          <a href="ptclm-examples.html" title="1.7.4. Examples of using PTCLM"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. CLM User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >1.7. Running PTCLM</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Erik Kluzek, Bill Sacks, Ben Andre.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>