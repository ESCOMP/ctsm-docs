

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.3. Using PTCLM &#8212; clmdoc  documentation</title>
    
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7.4. Examples of using PTCLM" href="ptclm-examples.html" />
    <link rel="prev" title="7.1. What is PTCLM" href="introduction-to-ptclm.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ptclm-examples.html" title="7.4. Examples of using PTCLM"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction-to-ptclm.html" title="7.1. What is PTCLM"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >CLM User&#8217;s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">7. Running PTCLM</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.3. Using PTCLM</a><ul>
<li><a class="reference internal" href="#steps-in-running-ptclm">7.3.1. Steps in running PTCLM</a></li>
<li><a class="reference internal" href="#ptclm-options">7.3.2. PTCLM options</a><ul>
<li><a class="reference internal" href="#example">7.3.2.1. EXAMPLE</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction-to-ptclm.html"
                        title="previous chapter">7.1. What is PTCLM</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ptclm-examples.html"
                        title="next chapter">7.4. Examples of using PTCLM</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/users_guide/running-PTCLM/using-ptclm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-ptclm">
<span id="using-ptclm-rst"></span><h1>7.3. Using PTCLM<a class="headerlink" href="#using-ptclm" title="Permalink to this headline">¶</a></h1>
<p>There are three types of options to PTCLM1: required, setup/run-time, and dataset generation options.
The three required options are the three settings that MUST be specified for PTCLM to work at all. The other settings have default values that will default to something useful. The setup/run-time options control how the simulation will be setup and run. The dataset generation options control the generation of datasets needed when PTCLM is run. Most options use a double dash &#8220;&#8211;&#8221; &#8220;longname&#8221; such as &#8220;&#8211;list&#8221;, but the most common options also have a short-name with a single dash (such as -m instead of &#8211;machine).</p>
<p>The required options to PTCLM are: inputdata directory (-d), machine (-m) and site-name (-s).
Inputdata directory is the directory where you have the CESM inputdata files, you need to have write access to this directory, so if you are running on a machine that you do NOT have write access to the standard inputdata location (such as NCAR yellowstone or LBNL hopper) you need to link the standard files to a location you do have control over. We recommend using the <code class="docutils literal"><span class="pre">scripts/link_dirtree</span></code> tool to do that. &#8220;machine&#8221; is the scripts name for the machine/compiler you will be using for your case. And finally site-name is the name of the site that you want to run for. Site-name can either be a valid supported dataset name or a Fluxnet site name from the list of sites you are running on (see the &#8211;sitegroupname for more information about the site lists).</p>
<p>After PTCLM is run a case directory where you can then setup, build and run your CESM case as normal.
It also creates a <code class="docutils literal"><span class="pre">README.PTCLM</span></code> in that directory that documents the commandline options to PTCLM that were used to create it.</p>
<p>After &#8220;help&#8221; the &#8220;list&#8221; option is one of the most useful options for getting help on using PTCLM.
This option gives you information about some of the other options to PTCLM. To get a list of the machine, sites, and compsets that can be used for PTCLM use the &#8220;&#8211;list&#8221; option as follows.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">scripts</span><span class="o">/</span><span class="n">ccsm_utils</span><span class="o">/</span><span class="n">Tools</span><span class="o">/</span><span class="n">lnd</span><span class="o">/</span><span class="n">clm</span><span class="o">/</span><span class="n">PTCLM</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">PTCLM</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">list</span>
</pre></div>
</div>
<p>The output to the above command is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1</span><span class="p">:</span> <span class="n">PTCLM</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">command</span> <span class="ow">not</span> <span class="n">found</span>
</pre></div>
</div>
<div class="section" id="steps-in-running-ptclm">
<h2>7.3.1. Steps in running PTCLM<a class="headerlink" href="#steps-in-running-ptclm" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Setup Inputdata directory with write access (use link_dirtree script)</p>
<p>You need to setup an inputdata directory where you have write access to it.
Normally, for NCAR machines the data is on an inputdata where the user does NOT have write access to it.
A way that you can get around this is to use the <strong>link_dirtree</strong> script to create softlinks from the normal location to a location you have write access to.
So for example on yellowstone:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; setenv CSMDATA $CESMDATAROOT/inputdata
&gt; setenv MYCSMDATA $HOME/inputdata
&gt; mkdir $MYCSMDATA
&gt; cd scripts
&gt; ./link_dirtree $CSMDATA $MYCSMDATA
</pre></div>
</div>
<p>See <a class="reference external" href="CLM-URL">the Section called Managing Your Own Data-files in Chapter 3</a> for more information on this.</p>
</li>
<li><p class="first">Build the CLM tools
Next you need to make sure all the CLM FORTRAN tools are built.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">models</span><span class="o">/</span><span class="n">lnd</span><span class="o">/</span><span class="n">clm</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">clm4_5</span><span class="o">/</span><span class="n">mksurfdata_map</span>
<span class="o">&gt;</span> <span class="n">gmake</span>
<span class="o">&gt;</span> <span class="n">gmake</span> <span class="n">clean</span>
<span class="o">&gt;</span> <span class="n">cd</span> <span class="o">../../../../../../</span><span class="n">tools</span><span class="o">/</span><span class="n">mapping</span><span class="o">/</span><span class="n">gen_domain_files</span><span class="o">/</span><span class="n">src</span>
<span class="o">&gt;</span> <span class="o">../../../../</span><span class="n">scripts</span><span class="o">/</span><span class="n">ccsm_utils</span><span class="o">/</span><span class="n">Machines</span><span class="o">/</span><span class="n">configure</span> <span class="o">-</span><span class="n">mach</span> <span class="n">yellowstone</span> <span class="o">-</span><span class="n">compiler</span> <span class="n">intel</span>
<span class="o">&gt;</span> <span class="n">gmake</span>
<span class="o">&gt;</span> <span class="n">gmake</span> <span class="n">clean</span>
</pre></div>
</div>
</li>
<li><p class="first">Run PTCLM
Next you actually run PTCLM1 which does the different things listed below:</p>
<ol class="loweralpha">
<li><p class="first">PTCLM names your case based on your input</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Prefix_</span><span class="p">]</span><span class="n">SiteCode_Compset</span><span class="p">[</span><span class="n">_QIAN</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Where:</dt>
<dd><p class="first"><code class="docutils literal"><span class="pre">Prefix</span></code> is from the caseidprefix option (or blank if not used).</p>
<p><code class="docutils literal"><span class="pre">SiteCode</span></code> is the site name you entered with the -s option.</p>
<p><code class="docutils literal"><span class="pre">Compset</span></code> is the compset name you entered with the -c option.</p>
<p class="last"><code class="docutils literal"><span class="pre">_QIAN</span></code> is part of the name only if the useQIAN is used.</p>
</dd>
</dl>
<p>For example, the casename for the following will be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd scripts
&gt; ./PTCLM.py -m yellowstone_intel -s US-UMB -d $MYCSMDATA -c ICRUCLM45BGC --use QIAN &quot;US-UMB_I_2000_CN_QIAN&quot;
</pre></div>
</div>
</li>
<li><p class="first">PTCLM creates datasets for you
It will populate $MYCSMDATA with new datasets it creates using the CLM tools.</p>
</li>
<li><p class="first">If a transient compset and PTCLM1 finds a _dynpftdata.txt file
If you are running a transient compset (such as the &#8220;I_1850-2000_CN&#8221; compset) AND you there is a file in the PTCLM_sitedata directory under the PTCLM directory called $SITE_dynpftdata.txt it will use this file for the land-use changes.
Otherwise it will leave land-use constant, unless you use the pftgrid option so it uses the global dataset for landuse changes.
See the Section called Dynamic Land-Use Change Files for use by PTCLM for more information on this.
There is a sample transient dataset called US-Ha1_dynpftdata.txt.
Transient compsets, are compsets that create transient land-use change and forcing conditions such as: &#8216;I_1850-2000&#8217;, &#8216;I_1850-2000_CN&#8217;, &#8216;I_RCP8.5_CN&#8217;, &#8216;I_RCP6.0_CN&#8217;, &#8216;I_RCP4.5_CN&#8217;, or &#8216;I_RCP2.6_CN&#8217;.</p>
</li>
<li><p class="first">PTCLM creates a pft-physiology for you
PTCLM1 will create a local copy of the pft-physiology specific for your site that you could then customize with changes specific for that site.</p>
</li>
<li><p class="first">PTCLM creates a README.PTCLM for you
PTCLM1 will create a simple text file with the command line for it in a file called README.PTCLM in the case directory it creates for you.</p>
</li>
</ol>
</li>
<li><p class="first">Customize, setup, build and run case as normal
You then customize your case as you would normally. See the Chapter 1 chapter for more information on doing this.</p>
</li>
</ol>
</div>
<div class="section" id="ptclm-options">
<h2>7.3.2. PTCLM options<a class="headerlink" href="#ptclm-options" title="Permalink to this headline">¶</a></h2>
<p>Next we discuss the setup and run-time options, dividing them up into setup, initial condition (IC), and run-time options.</p>
<p>Configure options include:</p>
<ul class="simple">
<li>&#8211;compset=MYCOMPSET</li>
<li>&#8211;caseidprefix=MYCASEID</li>
<li>&#8211;cesm_root=BASE_CESM</li>
<li>&#8211;namelist=NAMELIST</li>
<li>&#8211;rmold</li>
<li>&#8211;scratchroot=SCRATCHROOT</li>
<li>&#8211;sitegroupname=SITEGROUP</li>
<li>&#8211;QIAN_tower_yrs</li>
<li>&#8211;useQIAN</li>
</ul>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--compset</span></code></dt>
<dd>The &#8220;-c&#8221; option is the most commonly used option after the required options, as it specifies the CESM scripts component set to use with PTCLM1.
The default compset is the &#8220;ICN&#8221; compset with CN on for present day conditions.</dd>
<dt><code class="docutils literal"><span class="pre">--caseidprefix</span></code></dt>
<dd>This option gives a prefix to include in the casename when the case is created, in case you want to customize your casenames a bit.
By default, casenames are figured out based on the other options. The argument to this option can either be a name to prefix casenames with and/or a pathname to include.
Hence, if you want cases to appear in a specific directory you can give the pathname to that directory with this option.</dd>
<dt><code class="docutils literal"><span class="pre">--cesm_root</span></code></dt>
<dd>This option is for running PTCLM1 with a different root directory to CESM than the version PTCLM exists in. Normally you do NOT need to use this option.</dd>
<dt><code class="docutils literal"><span class="pre">--namelist</span></code></dt>
<dd>This option adds any items given into the CLM user_nl_clm namelist. This allows you to add customizations to the namelist before the clm.buildnml.csh file is created for the case.</dd>
<dt><code class="docutils literal"><span class="pre">--rmold</span></code></dt>
<dd>This option will remove an old case directory of the same name if one exists. Otherwise, if an old case directory already exists and you try to run PTCLM it will return with an error.</dd>
<dt><code class="docutils literal"><span class="pre">--scratchroot</span></code></dt>
<dd>This option is ONLY valid when using one of the generic machines (the -m option). This passed onto <strong>create_newcase</strong> and gives the location where cases will be built and run.</dd>
<dt><code class="docutils literal"><span class="pre">--sitegroupname</span></code></dt>
<dd>In the PTCLM directory there is a subdirectory &#8220;PTCLM_sitedata&#8221; that contains files with the site, PFT and soil data information for groups of sites.
These site groups are all separate ASCII files with the same prefix followed by a &#8220;_*data.txt&#8221; name. See <a class="reference external" href="CLM-URL">the Section called PTCLM Group Site Lists</a> for more information on these files. By default we have provided three different valid group names:</dd>
</dl>
<div class="section" id="example">
<h3>7.3.2.1. EXAMPLE<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>AmeriFlux</p>
<p>Fluxnet-Canada</p>
<p>The EXAMPLE is the group used by default and ONLY includes the US-UMB site as that is the only site we have data provided for.
The other two site groups include the site information for all of both the AmeriFlux and Fluxnet-Canada sites.
You can use the &#8220;sitegroupname&#8221; option to use one of the other lists, or you can create your own lists using the EXAMPLE file as an example.
Your list of sites could be real world locations or could be theoretical &#8220;virtual&#8221; sites given to exercise CLM on differing biomes for example.
Note, see <a class="reference external" href="CLM-URL">the Section called Converting AmeriFlux Data for use by PTCLM</a> with permission information to use the US-UMB data.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--useQIAN</span></code></dt>
<dd>This option says to use the standard CLM global Qian T62 atmospheric forcing rather than any tower site forcing data available. Otherwise, PTCLM will try to find tower forcing data for the specific site entered.</dd>
<dt><code class="docutils literal"><span class="pre">--QIAN_tower_yrs</span></code></dt>
<dd>This option is used with the &#8220;useQIAN&#8221; option to set the years to cycle over for the Qian data. In this case Qian atmospheric forcing will be used, but the simulation will run over the same years that tower site is available for this site.</dd>
</dl>
<p><strong>IC options include:</strong></p>
<ul class="simple">
<li>&#8211;coldstart</li>
<li>&#8211;finidat=FINIDAT</li>
</ul>
<p>The coldstart option says to startup with OUT an initial condition file, while the finidat option explicitly gives the initial condition file to use. Obviously, the coldstart and finidat options can NOT be used together.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--coldstart</span></code></dt>
<dd>This option ensures that a cold-start will be done with arbitrary initial conditions.</dd>
<dt><code class="docutils literal"><span class="pre">--finidat</span></code></dt>
<dd>This option sets the initial condition file to startup the simulation from.</dd>
</dl>
<p><strong>Run-time options include:</strong></p>
<ul class="simple">
<li>&#8211;debug</li>
<li>&#8211;run_n=MYRUN_N</li>
<li>&#8211;run_units=MYRUN_UNITS</li>
<li>&#8211;stdurbpt</li>
<li>&#8211;debug</li>
</ul>
<p>This option tells PTCLM to echo what it would do if it were run, but NOT actually run anything. So it will show you the dataset creation commands it would use. It does however, run <strong>create_newcase</strong>, but then it only displays the <strong>xmlchange</strong> commands and changes that it would do. Also note that if you give the &#8220;&#8211;rmold&#8221; option it won&#8217;t delete the case directory beforehand. Primarily this is intended for debugging the operation of PTCLM.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--run_n</span></code></dt>
<dd>This option along with run_units is used to set the length for the simulation. &#8220;run_n&#8221; is the number of units to use. The default run length depends on the site, compset, and configuration.</dd>
<dt><code class="docutils literal"><span class="pre">--run_units</span></code></dt>
<dd>This option is the units of time to use for the length of the simulation. It is used along with &#8220;run_n&#8221; to set the length of the simulation. The default run length depends on the site, compset, and configuration.</dd>
<dt><code class="docutils literal"><span class="pre">--stdurbpt</span></code></dt>
<dd>This option turns on the &#8220;stdurbpt_pd&#8221; use-case for CLM_NML_USE_CASE. This option can NOT be used for compsets that set the use-case to something besides present-day.</dd>
</dl>
<p><strong>The dataset generation options are:</strong></p>
<ul class="simple">
<li>&#8211;pftgrid</li>
<li>&#8211;soilgrid</li>
<li>&#8211;nopointdata</li>
<li>&#8211;owritesrfaer</li>
</ul>
<p>The options that with a &#8220;grid&#8221; suffix all mean to create datasets using the global gridded information rather than using the site specific point data. By default the site specific point data is used. The &#8220;nopointdata&#8221; and &#8220;owritesrfaer&#8221; options have to do with file creation.</p>
<p>Because supported single-point datasets already have the data created for them, you MUST use the &#8220;nopointdata&#8221; and &#8220;ndepgrid&#8221; options when you are using a supported single-point site. You must use &#8220;ndepgrid&#8221; even for a compset without CN. You also can NOT use the options: &#8220;soilgrid&#8221;, &#8220;pftgrid&#8221;, &#8220;aerdepgrid&#8221;, or &#8220;owritesrfaer&#8221;.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">--pftgrid</span></code></dt>
<dd>This option says to use the PFT values provided on the global dataset rather than using the specific site based values from the PTCLM_sitedata/*_pftdata.txt file when creating the surface dataset.
This option must NOT be used when you you are using a site that is a supported single point dataset.</dd>
<dt><code class="docutils literal"><span class="pre">--soilgrid</span></code></dt>
<dd>This option says to use the soil values provided on the global dataset rather than using the specific site based values from the PTCLM_sitedata/*_soildata.txt file when creating the surface dataset.
This option must NOT be used when you you are using a site that is a supported single point dataset.</dd>
<dt><code class="docutils literal"><span class="pre">--nopointdata</span></code></dt>
<dd><p class="first">This option says to NOT create any input datasets &#8211; assume this step has already been done.
If datasets weren&#8217;t already created, your case will fail when you try to run it.
In general the first time you run PTCLM for a new site you want it to generate new datasets, but the next time and future times you want to use this option so that it doesn&#8217;t waste a lot of time rebuilding datasets over again.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is required when you you are using a site that is a supported single point dataset.</p>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">--owritesrfaer</span></code></dt>
<dd>This option says to overwrite any surface and/or aerosol deposition datasets that were already created.
Otherwise, the creation of these files will be skipped if a file is already found (but it WILL create files if they don&#8217;t exist).
This option must NOT be used when you you are using a site that is a supported single point dataset.</dd>
</dl>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ptclm-examples.html" title="7.4. Examples of using PTCLM"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction-to-ptclm.html" title="7.1. What is PTCLM"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >CLM User&#8217;s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >7. Running PTCLM</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Erik Kluzek, Bill Sacks, Ben Andre.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>