

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>6.3. Running Single Point Configurations &#8212; clmdoc  documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7. Running PTCLM" href="../running-PTCLM/index.html" />
    <link rel="prev" title="6.2. Running a single point using global data - PTS_MODE" href="running-pts_mode-configurations.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../running-PTCLM/index.html" title="7. Running PTCLM"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="running-pts_mode-configurations.html" title="6.2. Running a single point using global data - PTS_MODE"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >CLM User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">6. Running Single Point Regional Cases</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6.3. Running Single Point Configurations</a><ul>
<li><a class="reference internal" href="#example-running-clm-over-a-single-point-test-site-in-brazil-with-the-default-qian-atmosphere-data-forcing">6.3.1. Example: Running CLM over a single-point test site in Brazil with the default Qian atmosphere data forcing.</a></li>
<li><a class="reference internal" href="#example-running-clm-over-the-single-point-of-mexicocity-mexico-with-the-default-qian-atmosphere-data-forcing">6.3.2. Example: Running CLM over the single-point of Mexicocity Mexico with the default Qian atmosphere data forcing.</a><ul>
<li><a class="reference internal" href="#using-supported-single-point-datasets-that-have-their-own-atmospheric-forcing">6.3.2.1. Using Supported Single-point Datasets that have their own Atmospheric Forcing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-running-clm-over-the-single-point-of-vancouver-canada-with-supplied-atmospheric-forcing-data-for-vancouver">6.3.3. Example: Running CLM over the single-point of Vancouver Canada with supplied atmospheric forcing data for Vancouver.</a><ul>
<li><a class="reference internal" href="#creating-your-own-single-point-dataset">6.3.3.1. Creating your own single-point dataset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-using-clm-usrdat-name-to-run-a-simulation-using-user-datasets-for-a-specific-region-over-alaska">6.3.4. Example: Using CLM_USRDAT_NAME to run a simulation using user datasets for a specific region over Alaska</a></li>
<li><a class="reference internal" href="#example-creating-a-surface-dataset-for-a-single-point">6.3.5. Example: Creating a surface dataset for a single point</a></li>
<li><a class="reference internal" href="#example-setting-up-a-case-from-the-single-point-surface-dataset-just-created">6.3.6. Example: Setting up a case from the single-point surface dataset just created</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="running-pts_mode-configurations.html"
                        title="previous chapter">6.2. Running a single point using global data - PTS_MODE</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../running-PTCLM/index.html"
                        title="next chapter">7. Running PTCLM</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/users_guide/running-single-points/running-single-point-configurations.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="running-single-point-configurations">
<span id="running-single-point-datasets"></span><h1>6.3. Running Single Point Configurations<a class="headerlink" href="#running-single-point-configurations" title="Permalink to this headline">¶</a></h1>
<p>In addition to <code class="docutils literal"><span class="pre">PTS_MODE</span></code>, CLM supports running using single-point or regional datasets that are customized to a particular region.
CLM supports a a small number of out-of-the-box single-point and regional datasets.
However, users can create their own dataset.</p>
<p>To get the list of supported dataset resolutions do this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">models</span><span class="o">/</span><span class="n">lnd</span><span class="o">/</span><span class="n">clm</span><span class="o">/</span><span class="n">doc</span>
<span class="o">&gt;</span> <span class="o">../</span><span class="n">bld</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">namelist</span> <span class="o">-</span><span class="n">res</span> <span class="nb">list</span>
</pre></div>
</div>
<p>Which results in the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CLM</span> <span class="n">build</span><span class="o">-</span><span class="n">namelist</span> <span class="o">-</span> <span class="n">valid</span> <span class="n">values</span> <span class="k">for</span> <span class="n">res</span> <span class="p">(</span><span class="n">Horizontal</span> <span class="n">resolutions</span>
<span class="n">Note</span><span class="p">:</span> <span class="mf">0.1</span><span class="n">x0</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="n">x0</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="n">x5min</span><span class="p">,</span> <span class="mi">10</span><span class="n">x10min</span><span class="p">,</span> <span class="mi">3</span><span class="n">x3min</span> <span class="ow">and</span> <span class="mf">0.33</span><span class="n">x0</span><span class="o">.</span><span class="mi">33</span> <span class="n">are</span> <span class="n">only</span> <span class="n">used</span> <span class="k">for</span> <span class="n">CLM</span> <span class="n">tools</span><span class="p">):</span>
      <span class="n">Values</span><span class="p">:</span> <span class="n">default</span> <span class="mi">512</span><span class="n">x1024</span> <span class="mi">360</span><span class="n">x720cru</span> <span class="mi">128</span><span class="n">x256</span> <span class="mi">64</span><span class="n">x128</span> <span class="mi">48</span><span class="n">x96</span> <span class="mi">32</span><span class="n">x64</span> <span class="mi">8</span><span class="n">x16</span> <span class="mi">94</span><span class="n">x192</span>  \
              <span class="mf">0.23</span><span class="n">x0</span><span class="o">.</span><span class="mi">31</span> <span class="mf">0.47</span><span class="n">x0</span><span class="o">.</span><span class="mi">63</span> <span class="mf">0.9</span><span class="n">x1</span><span class="o">.</span><span class="mi">25</span> <span class="mf">1.9</span><span class="n">x2</span><span class="o">.</span><span class="mi">5</span> <span class="mf">2.5</span><span class="n">x3</span><span class="o">.</span><span class="mi">33</span> <span class="mi">4</span><span class="n">x5</span> <span class="mi">10</span><span class="n">x15</span> <span class="mi">5</span><span class="n">x5_amazon</span> <span class="mi">1</span><span class="n">x1_tropicAtl</span> <span class="mi">1</span><span class="n">x1_camdenNJ</span>  \
              <span class="mi">1</span><span class="n">x1_vancouverCAN</span> <span class="mi">1</span><span class="n">x1_mexicocityMEX</span> <span class="mi">1</span><span class="n">x1_asphaltjungleNJ</span> <span class="mi">1</span><span class="n">x1_brazil</span> <span class="mi">1</span><span class="n">x1_urbanc_alpha</span> <span class="mi">1</span><span class="n">x1_numaIA</span>  \
              <span class="mi">1</span><span class="n">x1_smallvilleIA</span> <span class="mf">0.1</span><span class="n">x0</span><span class="o">.</span><span class="mi">1</span> <span class="mf">0.5</span><span class="n">x0</span><span class="o">.</span><span class="mi">5</span> <span class="mi">3</span><span class="n">x3min</span> <span class="mi">5</span><span class="n">x5min</span> <span class="mi">10</span><span class="n">x10min</span> <span class="mf">0.33</span><span class="n">x0</span><span class="o">.</span><span class="mi">33</span> <span class="n">ne4np4</span> <span class="n">ne16np4</span> <span class="n">ne30np4</span> <span class="n">ne60np4</span>  \
              <span class="n">ne120np4</span> <span class="n">ne240np4</span> <span class="n">wus12</span> <span class="n">us20</span>
      <span class="n">Default</span> <span class="o">=</span> <span class="mf">1.9</span><span class="n">x2</span><span class="o">.</span><span class="mi">5</span>
     <span class="p">(</span><span class="n">NOTE</span><span class="p">:</span> <span class="n">resolution</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">and</span> <span class="n">other</span> <span class="n">settings</span> <span class="n">may</span> <span class="n">influence</span> <span class="n">what</span> <span class="n">the</span> <span class="n">default</span> <span class="ow">is</span><span class="p">)</span>
</pre></div>
</div>
<p>The resolution names that have an underscore in them (“_”) are all single-point or regional resolutions.</p>
<p>To run for the Brazil test site do the following:</p>
<div class="section" id="example-running-clm-over-a-single-point-test-site-in-brazil-with-the-default-qian-atmosphere-data-forcing">
<h2>6.3.1. Example: Running CLM over a single-point test site in Brazil with the default Qian atmosphere data forcing.<a class="headerlink" href="#example-running-clm-over-a-single-point-test-site-in-brazil-with-the-default-qian-atmosphere-data-forcing" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd scripts
&gt; set SITE=1x1_brazil
&gt; ./create_newcase -case testSPDATASET -res $SITE -compset I
&gt; cd testSPDATASET
</pre></div>
</div>
<p>Then setup, build and run normally.</p>
<p>Then to run for the urban Mexico City Mexico test site that also has atmosphere forcing data, but to run it with the Qian forcing data, but over the period for which it’s own forcing data is provided do the following:</p>
</div>
<div class="section" id="example-running-clm-over-the-single-point-of-mexicocity-mexico-with-the-default-qian-atmosphere-data-forcing">
<h2>6.3.2. Example: Running CLM over the single-point of Mexicocity Mexico with the default Qian atmosphere data forcing.<a class="headerlink" href="#example-running-clm-over-the-single-point-of-mexicocity-mexico-with-the-default-qian-atmosphere-data-forcing" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd scripts
# Set a variable to the site you want to use (as it&#39;s used several times below)
&gt; set SITE=1x1_mexicocityMEX
&gt; ./create_newcase -case testSPDATASET -res $SITE -compset I
&gt; cd testSPDATASET
# Set DATM prescribed aerosols to single-point dataset
# Will then use the dataset with just the point for this $SITE
&gt; ./xmlchange DATM_PRESAERO=pt1_pt1
</pre></div>
</div>
<p>Then setup, build and run normally.</p>
<p><strong>Important:</strong> Just like PTS_MODE above, By default it sets up to run with <code class="docutils literal"><span class="pre">MPILIB=mpi-serial</span></code> (in the <code class="docutils literal"><span class="pre">env_build.xml</span></code> file) turned on, which allows you to run the model interactively. On some machines this mode is NOT supported and you may need to change it to FALSE before you are able to build.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">See <a class="reference external" href="CLM-URL">the Section called Warning about Running with a Single-Processor on a Batch Machine</a> for a warning about running single-point jobs on batch machines.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When running a <code class="docutils literal"><span class="pre">pt1_pt1</span></code> resolution the number of processors is automatically set to one. When running a single grid point you can only use a single processor. You might also want to set the <code class="docutils literal"><span class="pre">env_build.xml</span></code> variable: <code class="docutils literal"><span class="pre">MPILIB=mpi-serial</span></code> to TRUE so that you can also run interactively without having to use mpi to start up your job.</p>
</div>
<div class="section" id="using-supported-single-point-datasets-that-have-their-own-atmospheric-forcing">
<h3>6.3.2.1. Using Supported Single-point Datasets that have their own Atmospheric Forcing<a class="headerlink" href="#using-supported-single-point-datasets-that-have-their-own-atmospheric-forcing" title="Permalink to this headline">¶</a></h3>
<p>Of the supported single-point datasets we have three that also have atmospheric forcing data that go with them: Mexico City (Mexico), Vancouver, (Canada, British Columbia), and <code class="docutils literal"><span class="pre">urbanc_alpha</span></code> (test data for an Urban inter-comparison project).
Mexico city and Vancouver also have “#ifdef” in the source code for them to work with modified urban data parameters that are particular to these locations.
They can be turned on by using the <code class="docutils literal"><span class="pre">CLM_CONFIG_OPTS</span> <span class="pre">env_build.xml</span></code> variable to set the “-sitespf_pt” option in the CLM <strong>configure</strong>.
To turn on the atmospheric forcing for these datasets, you set the <code class="docutils literal"><span class="pre">env_run.xml</span> <span class="pre">DATM_MODE</span></code> variable to <code class="docutils literal"><span class="pre">CLM1PT</span></code>, and then the atmospheric forcing datasets will be used for the point picked.</p>
<p>When running with datasets that have their own atmospheric forcing you need to be careful to run over the period that data is available.
If you have at least one year of forcing it will cycle over the available data over and over again no matter how long of a simulation you run.
However, if you have less than a years worth of data (or if the start date doesn’t start at the beginning of the year, or the end date doesn’t end at the end of the year) then you won’t be able to run over anything but the data extent.
In this case you will need to carefully set the <code class="docutils literal"><span class="pre">RUN_STARTDATE</span></code>, <code class="docutils literal"><span class="pre">START_TOD</span></code> and <code class="docutils literal"><span class="pre">STOP_N/STOP_OPTION</span></code> variables for your case to run over the entire time extent of your data.
For the supported data points, these values are in the XML database and you can use the <strong>queryDefaultNamelist.pl</strong> script to query the values and set them for your case (they are set for the three urban test cases: Mexicocity, Vancouver, and urbanc_alpha).</p>
<p>In the example below we will show how to do this for the Vancouver, Canada point.</p>
</div>
</div>
<div class="section" id="example-running-clm-over-the-single-point-of-vancouver-canada-with-supplied-atmospheric-forcing-data-for-vancouver">
<h2>6.3.3. Example: Running CLM over the single-point of Vancouver Canada with supplied atmospheric forcing data for Vancouver.<a class="headerlink" href="#example-running-clm-over-the-single-point-of-vancouver-canada-with-supplied-atmospheric-forcing-data-for-vancouver" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd scripts

# Set a variable to the site you want to use (as it&#39;s used several times below)
&gt; set SITE=1x1_vancouverCAN

# Create a case at the single-point resolutions with their forcing
&gt; ./create_newcase -case testSPDATASETnAtmForcing -res $SITE -compset I1PTCLM45
&gt; cd testSPDATASETnAtmForcing

# Set namelist options for urban test site
&gt; ./xmlchange CLM_NML_USE_CASE=stdurbpt_pd

# Figure out the start and end date for this dataset
# You can do this by examining the datafile.
&gt; set STOP_N=330
&gt; set START_YEAR=1992
&gt; set STARTDATE=${START_YEAR}-08-12
&gt; @ NDAYS = $STOP_N / 24
&gt; ./xmlchange RUN_STARTDATE=$STARTDATE,STOP_N=$STOP_N,STOP_OPTION=nsteps

# Set the User namelist to set the output frequencies of the history files
# Setting the stdurbpt use-case option create three history file streams
# The frequencies and number of time-samples needs to be set
&gt; cat &lt;&lt; EOF &gt; user_nl_clm
hist_mfilt = $NDAYS,$STOP_N,$STOP_N
hist_nhtfrq = -1,1,1
EOF

# Set DATM prescribed aerosols to single-point dataset
# Will then use the dataset with just the point for this site
&gt; ./xmlchange DATM_PRESAERO=pt1_pt1
&gt; ./case.setup
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you don’t set the start-year and run-length carefully as shown above the model will abort with a “dtlimit error” in the atmosphere model (see bug 1110 in the <a class="reference external" href="CLM-URL">models/lnd/clm/doc/KnownLimitationss</a> file for documentation on this). Since, the forcing data for this site (and the MexicoCity site) is less than a year, the model won’t be able to run for a full year. The <code class="docutils literal"><span class="pre">1x1_urbanc_alpha</span></code> site has data for more than a full year, but neither year is complete hence, it has the same problem (see the problem for this site above).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Just like <code class="docutils literal"><span class="pre">PTS_MODE</span></code> above, By default it sets up to run with <code class="docutils literal"><span class="pre">MPILIB=mpi-serial</span></code> (in the env_build.xml file) turned on, which allows you to run the model interactively.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When running a <code class="docutils literal"><span class="pre">pt1_pt1</span></code> resolution the number of processors is automatically set to one. When running a single grid point you can only use a single processor. You might also want to set the <code class="docutils literal"><span class="pre">env_build.xml</span></code> variable: <code class="docutils literal"><span class="pre">MPILIB=mpi-serial</span></code> to <code class="docutils literal"><span class="pre">TRUE</span></code> so that you can also run interactively without having to use mpi to start up your job.</p>
</div>
<div class="section" id="creating-your-own-single-point-dataset">
<h3>6.3.3.1. Creating your own single-point dataset<a class="headerlink" href="#creating-your-own-single-point-dataset" title="Permalink to this headline">¶</a></h3>
<p>The following provides an example of setting up a case using <code class="docutils literal"><span class="pre">CLM_USRDAT_NAME</span></code> where you rename the files according to the <code class="docutils literal"><span class="pre">CLM_USRDAT_NAME</span></code> convention.
We have an example of such datafiles in the repository for a specific region over Alaska (actually just a sub-set of the global f19 grid).</p>
</div>
</div>
<div class="section" id="example-using-clm-usrdat-name-to-run-a-simulation-using-user-datasets-for-a-specific-region-over-alaska">
<h2>6.3.4. Example: Using CLM_USRDAT_NAME to run a simulation using user datasets for a specific region over Alaska<a class="headerlink" href="#example-using-clm-usrdat-name-to-run-a-simulation-using-user-datasets-for-a-specific-region-over-alaska" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd scripts
&gt; ./create_newcase -case my_userdataset_test -res CLM_USRDAT -compset ICRUCLM45
&gt; cd my_userdataset_test/
&gt; set GRIDNAME=13x12pt_f19_alaskaUSA
&gt; set LMASK=gx1v6
&gt; ./xmlchange CLM_USRDAT_NAME=$GRIDNAME,CLM_BLDNML_OPTS=&quot;-mask $LMASK&quot;
&gt; ./xmlchange ATM_DOMAIN_FILE=domain.lnd.${GRIDNAME}_$LMASK.nc
&gt; ./xmlchange LND_DOMAIN_FILE=domain.lnd.${GRIDNAME}_$LMASK.nc

# Make sure the file exists in your $CSMDATA or else use svn to download it there
&gt; ls $CSMDATA/lnd/clm2/surfdata_map/surfdata_${GRIDNAME}_simyr2000.nc

# If it doesn&#39;t exist, comment out the following...
#&gt; setenv SVN_INP_URL https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata/
#&gt; svn export $SVN_INP_URL/lnd/clm2/surfdata_map/surfdata_${GRIDNAME}_simyr2000.nc $CSMDATA/lnd/clm2/surfdata_map/surfdata_${GRIDNAME}_simyr2000.nc
&gt; ./case.setup
</pre></div>
</div>
<p>The first step is to create the domain and surface datasets using the process outlined in <a class="reference external" href="CLM-URL">the Section called The File Creation Process in Chapter 2</a>. Below we show an example of the process.</p>
</div>
<div class="section" id="example-creating-a-surface-dataset-for-a-single-point">
<h2>6.3.5. Example: Creating a surface dataset for a single point<a class="headerlink" href="#example-creating-a-surface-dataset-for-a-single-point" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span># set the GRIDNAME and creation date that will be used later
&gt; setenv GRIDNAME 1x1_boulderCO
&gt; setenv CDATE    `date +%y%m%d`
# Create the SCRIP grid file for the location and create a unity mapping file for it.
&gt; cd models/lnd/clm/tools/shared/mkmapdata
&gt; ./mknoocnmap.pl -p 40,255 -n $GRIDNAME
# Set pointer to MAPFILE just created that will be used later
&gt; setenv MAPFILE `pwd`/map_${GRIDNAME}_noocean_to_${GRIDNAME}_nomask_aave_da_${CDATE}.nc
# create the mapping files needed by mksurfdata_map.
&gt; cd ../../shared/mkmapdata
&gt; setenv GRIDFILE ../mkmapgrids/SCRIPgrid_${GRIDNAME}_nomask_${CDATE}.nc
&gt; ./mkmapdata.sh -r $GRIDNAME -f $GRIDFILE -t regional
# create the domain file
&gt; cd ../../../../tools/mapping/gen_domain_files/src
&gt; ../../../scripts/ccsm_utils/Machines/configure -mach yellowstone -compiler intel
&gt; gmake
&gt; cd ..
&gt; setenv OCNDOM domain.ocn_noocean.nc
&gt; setenv ATMDOM domain.lnd.{$GRIDNAME}_noocean.nc
&gt; ./gen_domain -m $MAPFILE -o $OCNDOM -l $ATMDOM
# Save the location where the domain file was created
&gt; setenv GENDOM_PATH `pwd`
# Finally create the surface dataset
&gt; cd ../../../../lnd/clm/tools/clm4_5/mksurfdata_map/src
&gt; gmake
&gt; cd ..
&gt; ./mksurfdata.pl -r usrspec -usr_gname $GRIDNAME -usr_gdate $CDATE
</pre></div>
</div>
<p>The next step is to create a case that points to the files you created above. We will still use the <code class="docutils literal"><span class="pre">CLM_USRDAT_NAME</span></code> option as a way to get a case setup without having to add the grid to scripts.</p>
</div>
<div class="section" id="example-setting-up-a-case-from-the-single-point-surface-dataset-just-created">
<h2>6.3.6. Example: Setting up a case from the single-point surface dataset just created<a class="headerlink" href="#example-setting-up-a-case-from-the-single-point-surface-dataset-just-created" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span># First setup an environment variable that points to the top of the CESM directory.
&gt; setenv CESMROOT &lt;directory-of-path-to-main-cesm-directory&gt;
# Next make sure you have a inputdata location that you can write to
# You only need to do this step once, so you won&#39;t need to do this in the future
&gt; setenv MYCSMDATA $HOME/inputdata     # Set env var for the directory for input data
&gt; ./link_dirtree $CSMDATA $MYCSMDATA
# Copy the file you created above to your new $MYCSMDATA location following the CLMUSRDAT
# naming convention (leave off the creation date)
&gt; cp $CESMROOT/models/lnd/clm/tools/clm4_5/mksurfdata_map/surfdata_${GRIDNAME}_simyr1850_$CDATE.nc \
$MYCSMDATA/lnd/clm2/surfdata_map/surfdata_${GRIDNAME}_simyr1850.nc
&gt; cd $CESMROOT/scripts
&gt; ./create_newcase -case my_usernldatasets_test -res CLM_USRDAT -compset I1850CRUCLM45BGC \
-mach yellowstone_intel
&gt; cd my_usernldatasets_test
&gt; ./xmlchange DIN_LOC_ROOT=$MYCSMDATA
# Set the path to the location of gen_domain set in the creation step above
&gt; ./xmlchange ATM_DOMAIN_PATH=$GENDOM_PATH,LND_DOMAIN_PATH=$GENDOM_PATH
&gt; ./xmlchange ATM_DOMAIN_FILE=$ATMDOM,LND_DOMAIN_FILE=$ATMDOM
&gt; ./xmlchange CLM_USRDAT_NAME=$GRIDNAME
&gt; ./case.setup
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With this and previous versions of the model we recommended using <code class="docutils literal"><span class="pre">CLM_USRDAT_NAME</span></code> as a way to identify your own datasets without having to enter them into the XML database. This has two down-sides. First you can’t include creation dates in your filenames, which means you can’t keep track of different versions by date. It also means you HAVE to rename the files after you created them with <strong>mksurfdata.pl</strong>. And secondly, you have to use <strong>linkdirtree</strong> in order to place the files in a location outside of the usual <code class="docutils literal"><span class="pre">DIN_LOC_ROOT</span></code> (assuming you don’t have write access to adding new files to the standard location on the machine you are using). Now, since <code class="docutils literal"><span class="pre">user_nl</span></code> files are supported for ALL model components, and the same domain files are read by both CLM and DATM and set using the envxml variables: <code class="docutils literal"><span class="pre">ATM_DOMAIN_PATH</span></code>, <code class="docutils literal"><span class="pre">ATM_DOMAIN_FILE</span></code>, <code class="docutils literal"><span class="pre">LND_DOMAIN_PATH</span></code>, and <code class="docutils literal"><span class="pre">LND_DOMAIN_FILE</span></code> – you can use this mechanism (<code class="docutils literal"><span class="pre">user_nl_clm</span></code> and <code class="docutils literal"><span class="pre">user_nl_datm</span></code> and those envxml variables) to point to your datasets in any location. In the future we will deprecate <code class="docutils literal"><span class="pre">CLM_USRDAT_NAME</span></code> and recommend <code class="docutils literal"><span class="pre">user_nl_clm</span></code> and <code class="docutils literal"><span class="pre">user_nl_datm</span></code> and the <code class="docutils literal"><span class="pre">DOMAIN</span></code> envxml variables.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../running-PTCLM/index.html" title="7. Running PTCLM"
             >next</a> |</li>
        <li class="right" >
          <a href="running-pts_mode-configurations.html" title="6.2. Running a single point using global data - PTS_MODE"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >CLM User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >6. Running Single Point Regional Cases</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Erik Kluzek, Bill Sacks, Ben Andre.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>