

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.8.1. Trouble Shooting &#8212; clmdoc release-clm5.0.01 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.9. Testing" href="../testing/index.html" />
    <link rel="prev" title="1.8. Troubleshooting" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../testing/index.html" title="1.9. Testing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="1.8. Troubleshooting"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc release-clm5.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. clm5.0 User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">1.8. Troubleshooting</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.8.1. Trouble Shooting</a><ul>
<li><a class="reference internal" href="#general-advice-on-debugging-run-time-problems">1.8.1.1. General Advice on Debugging Run time Problems</a><ul>
<li><a class="reference internal" href="#run-in-debug-mode">1.8.1.1.1. Run in DEBUG mode</a></li>
<li><a class="reference internal" href="#run-with-a-smaller-set-of-processors">1.8.1.1.2. Run with a smaller set of processors</a></li>
<li><a class="reference internal" href="#run-in-serial-mode-with-a-single-processor">1.8.1.1.3. Run in serial mode with a single processor</a></li>
<li><a class="reference internal" href="#run-at-a-lower-resolution">1.8.1.1.4. Run at a lower resolution</a></li>
<li><a class="reference internal" href="#run-a-simpler-case">1.8.1.1.5. Run a simpler case</a></li>
<li><a class="reference internal" href="#run-with-a-debugger">1.8.1.1.6. Run with a debugger</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">1.8. Troubleshooting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../testing/index.html"
                        title="next chapter">1.9. Testing</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/users_guide/trouble-shooting/trouble-shooting.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="trouble-shooting">
<span id="id1"></span><h1>1.8.1. Trouble Shooting<a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we give some guidance on what to do when you encounter some of the most common problems. We can’t cover all the problems that a user could potentially have, but we will try to help you recognize some of the most common situations. And we’ll give you some suggestions on how to approach the problem to come up with a solution.</p>
<p>In general you will run into one of three type of problems:</p>
<ol class="arabic simple">
<li><em>case-creation</em></li>
<li><em>setup-time</em></li>
<li><em>build-time</em></li>
<li><em>run-time</em></li>
</ol>
<p>See the <a class="reference external" href="http://esmci.github.io/cime/users_guide/troubleshooting.html">CIME Trouble Shooting Guide</a> for some help on the first three.</p>
<div class="section" id="general-advice-on-debugging-run-time-problems">
<h2>1.8.1.1. General Advice on Debugging Run time Problems<a class="headerlink" href="#general-advice-on-debugging-run-time-problems" title="Permalink to this headline">¶</a></h2>
<p>Here are some suggestions on how to track down a problem while running. In general if the problem still occurs for a simpler case, it will be easier to track down.</p>
<ol class="arabic simple">
<li><em>Run in DEBUG mode</em></li>
<li><em>Run with a smaller set of processors</em></li>
<li><em>Run in serial mode with a single processor</em></li>
<li><em>Run at a lower resolution</em></li>
<li><em>Run a simpler case</em></li>
<li><em>Run with a debugger</em></li>
</ol>
<div class="section" id="run-in-debug-mode">
<h3>1.8.1.1.1. Run in DEBUG mode<a class="headerlink" href="#run-in-debug-mode" title="Permalink to this headline">¶</a></h3>
<p>The first thing to try is to run in DEBUG mode so that float point trapping will be triggered as well as array bounds checking and other things the compiler can turn on to help you find problems.
To do this edit the <code class="docutils literal notranslate"><span class="pre">env_build.xml</span></code> file and set DEBUG to TRUE as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">DEBUG</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
</div>
<div class="section" id="run-with-a-smaller-set-of-processors">
<h3>1.8.1.1.2. Run with a smaller set of processors<a class="headerlink" href="#run-with-a-smaller-set-of-processors" title="Permalink to this headline">¶</a></h3>
<p>Another way to simplify the system is to run with a smaller set of processors. You will need to clean the setup and edit the –env_mach_pes.xml–. For example, to run with four processors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span> <span class="o">-</span><span class="n">clean</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">NTASKS_ATM</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_LND</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_ICE</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_OCN</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_CPL</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_GLC</span><span class="o">=</span><span class="mi">4</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span>
</pre></div>
</div>
<p>Another recommended simplification is to run without threading, so set the NTHRDS for each component to “1” if it isn’t already. Sometimes, multiprocessing problems require a certain number of processors before they occur so you may not be able to debug the problem without enough processors. But, it’s always good to reduce it to as low a number as possible to make it simpler. For threading problems you may have to have threading enabled to find the problem, but you can run with 1, 2, or 3 threads to see what happens.</p>
</div>
<div class="section" id="run-in-serial-mode-with-a-single-processor">
<h3>1.8.1.1.3. Run in serial mode with a single processor<a class="headerlink" href="#run-in-serial-mode-with-a-single-processor" title="Permalink to this headline">¶</a></h3>
<p>Simplifying to one processor removes all multi-processing problems and makes the case as simple as possible. If you can enable <code class="docutils literal notranslate"><span class="pre">MPILIB=mpi-serial</span></code> you will also be able to run interactively rather than having to submit to a job queue, which sometimes makes it easier to run and debug. If you can use <code class="docutils literal notranslate"><span class="pre">MPILIB=mpi-serial</span></code> you can also use threading, but still run interactively in order to use more processors to make it faster if needed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span> <span class="o">-</span><span class="n">clean</span>
<span class="c1"># Set tasks and threads for each component to 1</span>
<span class="c1"># You could also set threads to something &gt; 1 for speed, but still</span>
<span class="c1"># run interactively if threading isn&#39;t an issue.</span>

<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">NTASKS_ATM</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_ATM</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_LND</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_LND</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_ICE</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_ICE</span><span class="o">=</span><span class="mi">1</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">NTASKS_OCN</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_OCN</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_CPL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_CPL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_GLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_GLC</span><span class="o">=</span><span class="mi">1</span>
<span class="c1"># set MPILIB to mpi-serial so that you can run interactively</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">MPILIB</span><span class="o">=</span><span class="n">mpi</span><span class="o">-</span><span class="n">serial</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span>
<span class="c1"># Then build your case</span>
<span class="c1"># And finally run, by running the *.run script interactively</span>
</pre></div>
</div>
</div>
<div class="section" id="run-at-a-lower-resolution">
<h3>1.8.1.1.4. Run at a lower resolution<a class="headerlink" href="#run-at-a-lower-resolution" title="Permalink to this headline">¶</a></h3>
<p>If you can create a new case running at a lower resolution and replicate the problem it may be easier to solve. This of course requires creating a whole new case, and trying out different lower resolutions.</p>
</div>
<div class="section" id="run-a-simpler-case">
<h3>1.8.1.1.5. Run a simpler case<a class="headerlink" href="#run-a-simpler-case" title="Permalink to this headline">¶</a></h3>
<p>Along the same lines, you might try running a simpler case, trying another compset with a simpler setup and see if you can replicate the problem and then debug from that simpler case. Again, of course you will need to create new cases to do this.</p>
</div>
<div class="section" id="run-with-a-debugger">
<h3>1.8.1.1.6. Run with a debugger<a class="headerlink" href="#run-with-a-debugger" title="Permalink to this headline">¶</a></h3>
<p>Another suggestion is to run the model with a debugger such as: <strong>ddt</strong>, <strong>dbx</strong>, <strong>gdb</strong>, or <strong>totalview</strong>.
Often to run with a debugger you will need to reduce the number of processors as outlined above.
Some debuggers such as <strong>dbx</strong> will only work with one processor, while more advanced debuggers such as <strong>totalview</strong> can work with both MPI tasks and OMP threads.
Even simple debuggers though can be used to query core files, to see where the code was at when it died (for example using the <strong>where</strong> in <strong>dbx</strong> for a core file can be very helpful.
For help in running with a debugger you will need to contact your system administrators for the machine you are running on.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../testing/index.html" title="1.9. Testing"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="1.8. Troubleshooting"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc release-clm5.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. clm5.0 User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >1.8. Troubleshooting</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Erik Kluzek, Bill Sacks, Ben Andre.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>