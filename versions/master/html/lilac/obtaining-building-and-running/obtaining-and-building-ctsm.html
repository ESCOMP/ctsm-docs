

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2.1. Obtaining and building CTSM and LILAC &mdash; ctsm CTSM master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ctsm CTSM master documentation" href="../../index.html"/>
        <link rel="up" title="3.2. Obtaining, building and running CTSM with LILAC" href="index.html"/>
        <link rel="next" title="3.2.2. Setting CTSM runtime options" href="setting-ctsm-runtime-options.html"/>
        <link rel="prev" title="3.2. Obtaining, building and running CTSM with LILAC" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ctsm
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>CTSM1</option>
                      
                        
                      
                        
                          <option value="">[placeholder]</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/index.html">1. CTSM1 User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tech_note/index.html">2. CLM Technical Note</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">3. CTSM-LILAC User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction-and-overview/index.html">3.1. Introduction and overview of LILAC</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">3.2. Obtaining, building and running CTSM with LILAC</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.2.1. Obtaining and building CTSM and LILAC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quick-start-example-overview">3.2.1.1. Quick start example / overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">3.2.1.2. Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-ctsm">3.2.1.3. Obtaining CTSM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-ctsm-and-its-dependencies">3.2.1.4. Building CTSM and its dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#including-ctsm-in-the-atmosphere-model-s-build">3.2.1.5. Including CTSM in the atmosphere model’s build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="setting-ctsm-runtime-options.html">3.2.2. Setting CTSM runtime options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calling-ctsm-from-atm/index.html">3.3. Calling CTSM from an atmosphere model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specific-atm-models/index.html">3.4. Notes on specific atmosphere models</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ctsm</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">3. CTSM-LILAC User’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">3.2. Obtaining, building and running CTSM with LILAC</a> &raquo;</li>
        
      <li>3.2.1. Obtaining and building CTSM and LILAC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/lilac/obtaining-building-and-running/obtaining-and-building-ctsm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="obtaining-and-building-ctsm-and-lilac">
<span id="obtaining-and-building-ctsm"></span><h1>3.2.1. Obtaining and building CTSM and LILAC<a class="headerlink" href="#obtaining-and-building-ctsm-and-lilac" title="Permalink to this headline">¶</a></h1>
<p>This section describes the process for obtaining and building the CTSM library and its
dependencies, and linking to these libraries in an atmosphere model’s build.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This documentation only applies to the process where you are building CTSM with LILAC
for use in an atmosphere model that has <em>not</em> been integrated with CESM or CIME. If you
are using CTSM within CESM, or running CTSM in land-only mode with a data atmosphere,
then you should refer to the <a class="reference internal" href="../../users_guide/index.html#users-guide"><span class="std std-ref">general CTSM user’s guide</span></a> as well as
the <a class="reference external" href="http://esmci.github.io/cime">CIME documentation</a>.</p>
</div>
<div class="section" id="quick-start-example-overview">
<h2>3.2.1.1. Quick start example / overview<a class="headerlink" href="#quick-start-example-overview" title="Permalink to this headline">¶</a></h2>
<p>The basic process for obtaining and building CTSM is the following:</p>
<p>Obtain CTSM by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ESCOMP/CTSM.git
<span class="nb">cd</span> CTSM
./manage_externals/checkout_externals
</pre></div>
</div>
<p>Then build CTSM and its dependencies. On a machine that has been ported to CIME, the
command will look like this (example given for NCAR’s <code class="docutils literal notranslate"><span class="pre">cheyenne</span></code> machine):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./lilac/build_ctsm /glade/scratch/<span class="nv">$USER</span>/ctsm_build_dir --machine cheyenne --compiler intel
</pre></div>
</div>
<p>and then, before building the atmosphere model:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /glade/scratch/<span class="nv">$USER</span>/ctsm_build_dir/ctsm_build_environment.sh
</pre></div>
</div>
<p>On a machine that has <em>not</em> been ported to CIME, you will need to provide some additional
information. Run <code class="docutils literal notranslate"><span class="pre">./lilac/build_ctsm</span> <span class="pre">-h</span></code> for details, but the basic command will look
like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./lilac/build_ctsm ~/ctsm_build_dir --os Darwin --compiler gnu --netcdf-path /usr/local --esmf-lib-path /Users/sacks/ESMF/esmf8.0.0/lib/libO/Darwin.gfortranclang.64.mpich3.default --max-mpitasks-per-node <span class="m">4</span> --no-pnetcdf
</pre></div>
</div>
<p>In both cases, you will then need to include the necessary information in the include and
link lines of the atmosphere model’s build. For a Makefile-based build, this can be done
by including the file <code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD/ctsm.mk</span></code> in the atmosphere model’s build
scripts, then adding <code class="docutils literal notranslate"><span class="pre">CTSM_INCLUDES</span></code> to the include line and <code class="docutils literal notranslate"><span class="pre">CTSM_LIBS</span></code> to the link
line.</p>
<p>Further details on these steps are given below.</p>
</div>
<div class="section" id="prerequisites">
<span id="building-ctsm-and-lilac-prerequisites"></span><h2>3.2.1.2. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Building CTSM requires:</p>
<ul class="simple">
<li>a Unix-like operating system (Linux, AIX, OS X, etc.)</li>
<li>git version 1.8 or newer</li>
<li>python3<ul>
<li>The default version of python (when you run python without specifying 2 vs. 3) should
be python3</li>
</ul>
</li>
<li>perl version 5</li>
<li>a GNU version of the make tool (gmake)</li>
<li>CMake</li>
<li>Fortran and C compilers<ul>
<li>See <a class="reference external" href="https://github.com/escomp/cesm#details-on-fortran-compiler-versions">https://github.com/escomp/cesm#details-on-fortran-compiler-versions</a> for
information on compiler versions known to work with CESM, and thus CTSM.</li>
</ul>
</li>
<li>LAPACK and BLAS libraries</li>
<li>a NetCDF library version 4.3 or newer built with the same compiler you will use for CTSM<ul>
<li>a PNetCDF library is optional</li>
</ul>
</li>
<li>a functioning MPI environment<ul>
<li>typically, this includes compiler wrappers like <code class="docutils literal notranslate"><span class="pre">mpif90</span></code> and <code class="docutils literal notranslate"><span class="pre">mpicc</span></code></li>
</ul>
</li>
<li>ESMF version 8 or later<ul>
<li><strong>ESMF is not needed in general for CTSM, but is needed for LILAC</strong></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="obtaining-ctsm">
<h2>3.2.1.3. Obtaining CTSM<a class="headerlink" href="#obtaining-ctsm" title="Permalink to this headline">¶</a></h2>
<p>CTSM and its dependencies (excluding the <a class="reference internal" href="#building-ctsm-and-lilac-prerequisites"><span class="std std-ref">prerequisites noted
above</span></a>) can be obtained with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ESCOMP/CTSM.git
<span class="nb">cd</span> CTSM
./manage_externals/checkout_externals
</pre></div>
</div>
<p>By default, this will put you on the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of CTSM, which is the main
development branch. You can checkout a different branch or tag using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span></code>;
<strong>be sure to rerun</strong> <code class="docutils literal notranslate"><span class="pre">./manage_externals/checkout_externals</span></code> <strong>after doing so.</strong></p>
<p>For more details, see
<a class="reference external" href="https://github.com/ESCOMP/CTSM/wiki/Quick-start-to-CTSM-development-with-git">https://github.com/ESCOMP/CTSM/wiki/Quick-start-to-CTSM-development-with-git</a></p>
</div>
<div class="section" id="building-ctsm-and-its-dependencies">
<h2>3.2.1.4. Building CTSM and its dependencies<a class="headerlink" href="#building-ctsm-and-its-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>3.2.1.4.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>CTSM provides a build script, <code class="docutils literal notranslate"><span class="pre">lilac/build_ctsm</span></code>, for building CTSM and its dependencies. (The
dependencies built with this build script include various libraries that are packaged with
<a class="reference external" href="http://esmci.github.io/cime">CIME</a>. This does <em>not</em> build the <a class="reference internal" href="#building-ctsm-and-lilac-prerequisites"><span class="std std-ref">prerequisites noted
above</span></a>: it is assumed that those are already built
on your machine.)</p>
<p>There are two possible workflows for building CTSM and its dependencies. The first works
if you are using a machine that has been ported to <a class="reference external" href="http://esmci.github.io/cime">CIME</a>; the second works if you are
using a machine that has <em>not</em> been ported to <a class="reference external" href="http://esmci.github.io/cime">CIME</a>. Both workflows are described
below. If you are using a machine that has not been ported to CIME, it is possible to do a
complete CIME port and then use the first workflow (by following the <a class="reference external" href="http://esmci.github.io/cime/versions/master/html/users_guide/porting-cime.html">CIME porting guide</a>), but
unless you need to do so for other reasons (such as running CESM, or running CTSM in a
land-only configuration forced by a data atmosphere, using the <a class="reference external" href="http://esmci.github.io/cime">CIME</a> scripting
infrastructure), it is generally simpler to use the second workflow below: A full CIME
port requires many settings that are not needed for just building CTSM.</p>
<p>There is a third usage where you simply want to rebuild after making some source code
changes to CTSM. This is also documented below.</p>
<p>All of these workflows use CIME’s build system behind the scenes. Typically, you will not
need to be aware of any of those details, but if problems arise, you may want to consult
the <a class="reference external" href="http://esmci.github.io/cime">CIME documentation</a>.</p>
</div>
<div class="section" id="building-on-a-cime-supported-machine">
<span id="id1"></span><h3>3.2.1.4.2. Building on a CIME-supported machine<a class="headerlink" href="#building-on-a-cime-supported-machine" title="Permalink to this headline">¶</a></h3>
<p>If you are using a machine that has been ported to <a class="reference external" href="http://esmci.github.io/cime">CIME</a> (for example, NCAR’s <code class="docutils literal notranslate"><span class="pre">cheyenne</span></code>
machine), then you do not need to specify much information to <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code>. In addition,
in this case, CIME will load the appropriate modules and set the appropriate environment
variables at build time, so you do not need to do anything to set up your environment
ahead of time. <strong>Building CTSM with LILAC requires ESMF. ESMF is currently an optional
CIME dependency, so many CIME-ported machines do not provide information on an ESMF
installation. NCAR’s cheyenne machine DOES provide ESMF, but for other machines, you may
need to add this to your CIME port.</strong></p>
<p>To build CTSM and its dependencies in this case, run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./lilac/build_ctsm /PATH/TO/CTSM/BUILD --machine MACHINE --compiler COMPILER
</pre></div>
</div>
<p>where you should fill in the capitalized arguments with appropriate values for your
machine.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The given directory (<code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD</span></code>) must <em>not</em> exist. This directory is
created for you by the build script.</p>
</div>
<p>Some other options to <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> are supported in this case (but many are not, since
they are only applicable to the non-CIME-supported machine workflow); run
<code class="docutils literal notranslate"><span class="pre">./lilac/build_ctsm</span> <span class="pre">-h</span></code> for details.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If PNetCDF (parallel NetCDF) is not available on this machine, you will need to add the
option <code class="docutils literal notranslate"><span class="pre">--no-pnetcdf</span></code>.</p>
</div>
<p>Besides the build files themselves, <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> creates the following important files
that are needed for the build of the atmosphere model:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD/ctsm.mk</span></code>: This Makefile-formatted file gives variables that
should be set in the atmosphere model’s build. <a class="reference internal" href="#including-ctsm-in-the-atmosphere-model-build"><span class="std std-ref">See below for information on how
to use this file</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD/ctsm_build_environment.sh</span></code> or
<code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD/ctsm_build_environment.csh</span></code>: These files specify the build
environment that CIME used to build CTSM and its dependencies. <strong>Before building the
atmosphere model, you should source the appropriate file</strong> (based on your shell - use
the <code class="docutils literal notranslate"><span class="pre">.sh</span></code> file for bash and similar shells, and the <code class="docutils literal notranslate"><span class="pre">.csh</span></code> file for tcsh and
similar shells). <strong>This will ensure that the atmosphere model is built with the same
compiler and library versions as CTSM.</strong> For example, with bash: <code class="docutils literal notranslate"><span class="pre">source</span>
<span class="pre">/PATH/TO/CTSM/BUILD/ctsm_build_environment.sh</span></code>.</li>
</ol>
</div>
<div class="section" id="building-on-a-machine-that-has-not-been-ported-to-cime">
<h3>3.2.1.4.3. Building on a machine that has not been ported to CIME<a class="headerlink" href="#building-on-a-machine-that-has-not-been-ported-to-cime" title="Permalink to this headline">¶</a></h3>
<p>If you are using a machine thata has not been ported to <a class="reference external" href="http://esmci.github.io/cime">CIME</a>, then you need to specify
additional information to <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> that is needed by the build system. Before
building CTSM, you should load any modules and/or set any environment variables required
by the atmosphere model or CTSM builds, including all of the <a class="reference internal" href="#building-ctsm-and-lilac-prerequisites"><span class="std std-ref">prerequisites noted
above</span></a>.</p>
<p>The minimal amount of information needed is given by the following:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./lilac/build_ctsm /PATH/TO/CTSM/BUILD --os OS --compiler COMPILER --netcdf-path NETCDF_PATH --esmf-lib-path ESMF_LIB_PATH --max-mpitasks-per-node MAX_MPITASKS_PER_NODE --pnetcdf-path PNETCDF_PATH
</pre></div>
</div>
<p>where you should fill in the capitalized arguments with appropriate values for your
machine. Run <code class="docutils literal notranslate"><span class="pre">./lilac/build_ctsm</span> <span class="pre">-h</span></code> for details on these arguments, as well as documentation
of additional, optional arguments. Some of these optional arguments may be needed for
successful compilation, while others (such as <code class="docutils literal notranslate"><span class="pre">--pnetcdf-path</span></code>) may be needed for good
model performance.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The given directory (<code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD</span></code>) must <em>not</em> exist. This directory is
created for you by the build script.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If PNetCDF (parallel NetCDF) is not available on your machine/compiler, you should use
the option <code class="docutils literal notranslate"><span class="pre">--no-pnetcdf</span></code> instead of <code class="docutils literal notranslate"><span class="pre">--pnetcdf-path</span></code>. You must specify exactly one
of those two options.</p>
</div>
<p>Example usage for a Mac (a simple case) is:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./lilac/build_ctsm ~/ctsm_build_dir --os Darwin --compiler gnu --netcdf-path /usr/local --esmf-lib-path /Users/sacks/ESMF/esmf8.0.0/lib/libO/Darwin.gfortranclang.64.mpich3.default --max-mpitasks-per-node <span class="m">4</span> --no-pnetcdf
</pre></div>
</div>
<p>Example usage for NCAR’s <code class="docutils literal notranslate"><span class="pre">cheyenne</span></code> machine (a more complex case) is:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>module purge
module load ncarenv/1.3 intel/19.0.5 esmf_libs mkl
module use /glade/work/himanshu/PROGS/modulefiles/esmfpkgs/intel/19.0.5
module load esmf-8.1.0b14-ncdfio-mpt-O mpt/2.21 netcdf/4.7.3 pnetcdf/1.12.1 ncarcompilers/0.5.0
module load python

./lilac/build_ctsm /glade/scratch/<span class="nv">$USER</span>/ctsm_build_dir --os linux --compiler intel --netcdf-path <span class="s1">&#39;$ENV{NETCDF}&#39;</span> --pio-filesystem-hints gpfs --pnetcdf-path <span class="s1">&#39;$ENV{PNETCDF}&#39;</span> --esmf-lib-path <span class="s1">&#39;$ENV{ESMF_LIBDIR}&#39;</span> --max-mpitasks-per-node <span class="m">36</span> --extra-cflags <span class="s1">&#39;-xCORE_AVX2 -no-fma&#39;</span> --extra-fflags <span class="s1">&#39;-xCORE_AVX2 -no-fma&#39;</span>
</pre></div>
</div>
<p>(It’s better to use the <a class="reference internal" href="#building-on-a-cime-supported-machine"><span class="std std-ref">alternative process for a CIME-supported
machine</span></a> in this case, but the above illustrates
what would be needed for a machine similar to this that has not been ported to CIME.)</p>
<p>Besides the build files themselves, <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> creates an important file that is
needed for the build of the atmosphere model: <code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD/ctsm.mk</span></code>. This
Makefile-formatted file gives variables that should be set in the atmosphere model’s
build. <a class="reference internal" href="#including-ctsm-in-the-atmosphere-model-build"><span class="std std-ref">See below for information on how to use this
file</span></a>.</p>
</div>
<div class="section" id="rebuilding-after-changing-ctsm-source-code">
<h3>3.2.1.4.4. Rebuilding after changing CTSM source code<a class="headerlink" href="#rebuilding-after-changing-ctsm-source-code" title="Permalink to this headline">¶</a></h3>
<p>To rebuild after changing CTSM source code, you should follow one of the above workflows,
but the <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> command will simply be:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./lilac/build_ctsm /PATH/TO/CTSM/BUILD --rebuild
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD</span></code> should point to the same directory you originally used.</p>
</div>
</div>
<div class="section" id="including-ctsm-in-the-atmosphere-model-s-build">
<span id="including-ctsm-in-the-atmosphere-model-build"></span><h2>3.2.1.5. Including CTSM in the atmosphere model’s build<a class="headerlink" href="#including-ctsm-in-the-atmosphere-model-s-build" title="Permalink to this headline">¶</a></h2>
<p>Once you have successfully built CTSM and its dependencies, you will need to add various
paths to the compilation and link lines when building your atmosphere model. For a
Makefile-based build system, we facilitate this by producing a file,
<code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD/ctsm.mk</span></code>, which you can include in your own build script. (We do
not yet produce an equivalent for CMake or other build systems.)</p>
<p>There are two important variables defined in this file:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">CTSM_INCLUDES</span></code>: This variable should be included in the compilation line for the
atmosphere model’s source files. It lists all paths that need to be included in these
compilations so that the compiler can find the appropriate Fortran module files.</li>
<li><code class="docutils literal notranslate"><span class="pre">CTSM_LIBS</span></code>: This variable should be included in the link line when creating the final
executable. It lists paths and library names that need to be included in the link
step. <strong>Note: This may not include all of the libraries that are</strong>
<a class="reference internal" href="#building-ctsm-and-lilac-prerequisites"><span class="std std-ref">prerequisites</span></a>, <strong>such as LAPACK, BLAS and
NetCDF. If your atmosphere doesn’t already require these, you may need to add
appropriate information to your atmosphere model’s link line.</strong> However, it should
already include all required link information for ESMF.</li>
</ul>
<p>Other variables in this file do not need to be included directly in the atmosphere model’s
build (they are just intermediate variables used to create <code class="docutils literal notranslate"><span class="pre">CTSM_INCLUDES</span></code> and
<code class="docutils literal notranslate"><span class="pre">CTSM_LIBS</span></code>).</p>
<p>For example, for the WRF build, we do the following: If building with CTSM, then we
expect that the user has set an environment variable:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">WRF_CTSM_MKFILE</span><span class="o">=</span>/PATH/TO/CTSM/BUILD/ctsm.mk
</pre></div>
</div>
<p>If that environment variable exists, then the <code class="docutils literal notranslate"><span class="pre">configure</span></code> script adds the following to
the Makefile-based build:</p>
<ul class="simple">
<li>Includes the <code class="docutils literal notranslate"><span class="pre">ctsm.mk</span></code> file (like <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">${WRF_CTSM_MKFILE}</span></code>)</li>
<li>Adds a CPP definition, <code class="docutils literal notranslate"><span class="pre">-DWRF_USE_CTSM</span></code>, which is used to do conditional compilation
of the CTSM-LILAC interface code</li>
<li>Adds <code class="docutils literal notranslate"><span class="pre">$(CTSM_INCLUDES)</span></code> to its variable <code class="docutils literal notranslate"><span class="pre">INCLUDE_MODULES</span></code></li>
<li>Adds <code class="docutils literal notranslate"><span class="pre">$(CTSM_LIBS)</span></code> to its variable <code class="docutils literal notranslate"><span class="pre">LIB</span></code></li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="setting-ctsm-runtime-options.html" class="btn btn-neutral float-right" title="3.2.2. Setting CTSM runtime options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="3.2. Obtaining, building and running CTSM with LILAC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, UCAR.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/pop_ver.js"></script>
    

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>