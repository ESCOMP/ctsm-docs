

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2.1. Obtaining and building CTSM and LILAC &mdash; ctsm CTSM master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ctsm CTSM master documentation" href="../../index.html"/>
        <link rel="up" title="3.2. Obtaining, building and running CTSM" href="index.html"/>
        <link rel="next" title="3.2.2. Setting CTSM runtime options" href="setting-ctsm-runtime-options.html"/>
        <link rel="prev" title="3.2. Obtaining, building and running CTSM" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ctsm
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>CTSM1</option>
                      
                        
                      
                        
                          <option value="">[placeholder]</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/index.html">1. CTSM1 User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tech_note/index.html">2. CLM Technical Note</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">3. CTSM-LILAC User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction-and-overview/index.html">3.1. Introduction and overview of LILAC</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">3.2. Obtaining, building and running CTSM</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.2.1. Obtaining and building CTSM and LILAC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quick-start-example">3.2.1.1. Quick start example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">3.2.1.2. Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-ctsm">3.2.1.3. Obtaining CTSM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-ctsm-and-its-dependencies-and-including-ctsm-in-the-atmosphere-model-s-build">3.2.1.4. Building CTSM and its dependencies, and including CTSM in the atmosphere model’s build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="setting-ctsm-runtime-options.html">3.2.2. Setting CTSM runtime options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calling-ctsm-from-atm/index.html">3.3. Calling CTSM from an atmosphere model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specific-atm-models/index.html">3.4. Notes on specific atmosphere models</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ctsm</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">3. CTSM-LILAC User’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">3.2. Obtaining, building and running CTSM</a> &raquo;</li>
        
      <li>3.2.1. Obtaining and building CTSM and LILAC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/lilac/obtaining-building-and-running/obtaining-and-building-ctsm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="obtaining-and-building-ctsm-and-lilac">
<h1>3.2.1. Obtaining and building CTSM and LILAC<a class="headerlink" href="#obtaining-and-building-ctsm-and-lilac" title="Permalink to this headline">¶</a></h1>
<p>This section describes the process for obtaining and building the CTSM library and its
dependencies, and linking to these libraries in an atmosphere model’s build.</p>
<div class="section" id="quick-start-example">
<h2>3.2.1.1. Quick start example<a class="headerlink" href="#quick-start-example" title="Permalink to this headline">¶</a></h2>
<p>The basic process for obtaining and building CTSM is the following:</p>
<p>Obtain CTSM by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ESCOMP/CTSM.git
<span class="nb">cd</span> CTSM
./manage_externals/checkout_externals
</pre></div>
</div>
<p>Then build CTSM and its dependencies. On a machine that has been ported to CIME, the
command will look like this (example given for NCAR’s <code class="docutils literal notranslate"><span class="pre">cheyenne</span></code> machine):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./build_ctsm /glade/scratch/<span class="nv">$USER</span>/ctsm_build_dir --compiler intel --machine cheyenne
</pre></div>
</div>
<p>On a machine that has <em>not</em> been ported to CIME, you will need to provide some additional
information. Run <code class="docutils literal notranslate"><span class="pre">build_ctsm</span> <span class="pre">-h</span></code> for details, but the basic command will look like
this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./build_ctsm ~/ctsm_build_dir --os Darwin --compiler gnu --netcdf-path /usr/local --esmf-lib-path /Users/sacks/ESMF/esmf8.0.0/lib/libO/Darwin.gfortranclang.64.mpich3.default
</pre></div>
</div>
<p>Further details on these commands are given below.</p>
</div>
<div class="section" id="prerequisites">
<span id="building-ctsm-and-lilac-prerequisites"></span><h2>3.2.1.2. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Building CTSM requires:</p>
<ul class="simple">
<li>a Unix-like operating system (Linux, AIX, OS X, etc.)</li>
<li>git version 1.8 or newer</li>
<li>python3<ul>
<li>The default version of python (when you run python without specifying 2 vs. 3) should
be python3</li>
</ul>
</li>
<li>perl version 5</li>
<li>a GNU version of the make tool (gmake)</li>
<li>CMake</li>
<li>Fortran and C compilers<ul>
<li>See <a class="reference external" href="https://github.com/escomp/cesm#details-on-fortran-compiler-versions">https://github.com/escomp/cesm#details-on-fortran-compiler-versions</a> for
information on compiler versions known to work with CESM, and thus CTSM.</li>
</ul>
</li>
<li>LAPACK and BLAS libraries</li>
<li>a NetCDF library version 4.3 or newer built with the same compiler you will use for CTSM<ul>
<li>a PnetCDF library is optional</li>
</ul>
</li>
<li>a functioning MPI environment<ul>
<li>typically, this includes compiler wrappers like <code class="docutils literal notranslate"><span class="pre">mpif90</span></code> and <code class="docutils literal notranslate"><span class="pre">mpicc</span></code></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="obtaining-ctsm">
<h2>3.2.1.3. Obtaining CTSM<a class="headerlink" href="#obtaining-ctsm" title="Permalink to this headline">¶</a></h2>
<p>CTSM and its dependencies (excluding the <a class="reference internal" href="#building-ctsm-and-lilac-prerequisites"><span class="std std-ref">prerequisites noted
above</span></a>) can be obtained with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ESCOMP/CTSM.git
<span class="nb">cd</span> CTSM
./manage_externals/checkout_externals
</pre></div>
</div>
<p>By default, this will put you on the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of CTSM, which is the main
development branch. You can checkout a different branch or tag using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span></code>;
<strong>be sure to rerun</strong> <code class="docutils literal notranslate"><span class="pre">./manage_externals/checkout_externals</span></code> <strong>after doing so.</strong></p>
<p>For more details, see
<a class="reference external" href="https://github.com/ESCOMP/CTSM/wiki/Quick-start-to-CTSM-development-with-git">https://github.com/ESCOMP/CTSM/wiki/Quick-start-to-CTSM-development-with-git</a></p>
</div>
<div class="section" id="building-ctsm-and-its-dependencies-and-including-ctsm-in-the-atmosphere-model-s-build">
<h2>3.2.1.4. Building CTSM and its dependencies, and including CTSM in the atmosphere model’s build<a class="headerlink" href="#building-ctsm-and-its-dependencies-and-including-ctsm-in-the-atmosphere-model-s-build" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>3.2.1.4.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>CTSM provides a build script, <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> for building CTSM and its dependencies. (The
dependencies built with this build script include various libraries that are packaged with
<a class="reference external" href="https://github.com/esmci/cime">CIME</a>. This does <em>not</em> build the <a class="reference internal" href="#building-ctsm-and-lilac-prerequisites"><span class="std std-ref">prerequisites noted
above</span></a>: it is assumed that those are already built
on your machine.)</p>
<p>There are two possible workflows for building CTSM and its dependencies. The first works
if you are using a machine that has been ported to <a class="reference external" href="https://github.com/esmci/cime">CIME</a>; the second works if you are
using a machine that has <em>not</em> been ported to <a class="reference external" href="https://github.com/esmci/cime">CIME</a>. Both workflows are described
below. If you are using a machine that has not been ported to CIME, it is possible to do a
complete CIME port and then use the first workflow (by following the <a class="reference external" href="http://esmci.github.io/cime/versions/master/html/users_guide/porting-cime.html">CIME porting guide</a>), but
unless you need to do so for other reasons (such as running CESM), it is generally simpler
to use the second workflow below: A full CIME port requires many settings that are not
needed for just building CTSM.</p>
<p>There is a third usage where you simply want to rebuild after making some source code
changes to CTSM. This is also documented below.</p>
<p>All of these workflows use CIME’s build system behind the scenes. Typically, you will not
need to be aware of any of those details, but if problems arise, you may want to consult
the <a class="reference external" href="http://esmci.github.io/cime">CIME documentation</a>.</p>
</div>
<div class="section" id="building-on-a-cime-supported-machine">
<h3>3.2.1.4.2. Building on a CIME-supported machine<a class="headerlink" href="#building-on-a-cime-supported-machine" title="Permalink to this headline">¶</a></h3>
<p>If you are using a machine that has been ported to <a class="reference external" href="https://github.com/esmci/cime">CIME</a> (for example, NCAR’s <code class="docutils literal notranslate"><span class="pre">cheyenne</span></code>
machine), then you do not need to specify much information to <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code>. In addition,
in this case, CIME will load the appropriate modules and set the appropriate environment
variables at build time, so you do not need to do anything to set up your environment
ahead of time.</p>
<p>To build CTSM and its dependencies in this case, run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./build_ctsm /PATH/TO/CTSM/BUILD --machine MACHINE --compiler COMPILER
</pre></div>
</div>
<p>where you should fill in the capitalized arguments with appropriate values for your
machine.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The given directory (<code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD</span></code>) must <em>not</em> exist. This directory is
created for you by the build script.</p>
</div>
</div>
<div class="section" id="rebuilding-after-changing-ctsm-source-code">
<h3>3.2.1.4.3. Rebuilding after changing CTSM source code<a class="headerlink" href="#rebuilding-after-changing-ctsm-source-code" title="Permalink to this headline">¶</a></h3>
<p>To rebuild after changing CTSM source code, you should follow one of the above workflows,
but the <code class="docutils literal notranslate"><span class="pre">build_ctsm</span></code> command will simply be:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./build_ctsm /PATH/TO/CTSM/BUILD --rebuild
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">/PATH/TO/CTSM/BUILD</span></code> should point to the same directory you originally used.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="setting-ctsm-runtime-options.html" class="btn btn-neutral float-right" title="3.2.2. Setting CTSM runtime options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="3.2. Obtaining, building and running CTSM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, UCAR.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/pop_ver.js"></script>
    

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>