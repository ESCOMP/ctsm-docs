

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.7.1. What is PTCLMmkdata? &#8212; clmdoc release-clm5.0.01 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.7.3. Using PTCLMmkdata" href="using-ptclm.html" />
    <link rel="prev" title="1.7. Running PTCLM" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="using-ptclm.html" title="1.7.3. Using PTCLMmkdata"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="1.7. Running PTCLM"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc release-clm5.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. clm5.0 User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">1.7. Running PTCLM</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.7.1. What is PTCLMmkdata?</a></li>
<li><a class="reference internal" href="#details-of-ptclmmkdata">1.7.2. Details of PTCLMmkdata</a><ul>
<li><a class="reference internal" href="#example-6-1-example-of-running-ptclmmkdata-for-us-umb-on-cheyenne">1.7.2.1. Example 6-1. Example of running PTCLMmkdata for US-UMB on cheyenne</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">1.7. Running PTCLM</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="using-ptclm.html"
                        title="next chapter">1.7.3. Using PTCLMmkdata</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/users_guide/running-PTCLM/introduction-to-ptclm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="what-is-ptclmmkdata">
<span id="what-is-ptclm"></span><span id="introduction-to-ptclm-rst"></span><h1>1.7.1. What is PTCLMmkdata?<a class="headerlink" href="#what-is-ptclmmkdata" title="Permalink to this headline">¶</a></h1>
<p>PTCLMmkdata (pronounced Pee-Tee Cee-L-M make data is a Python script to help you set up PoinT CLM simulations.</p>
<p>It runs the CLM tools for you to get datasets set up, and copies them to a location you can use them including the changes
needed for a case to use the dataset with namelist and XML changes.</p>
<p>Then you run <strong>create_newcase</strong> and point to the directory so that the namelist and XML changes are automatically applied.</p>
<p>PTCLMmkdata has a simple ASCII text file for storing basic information for your sites.</p>
<p>We also have complete lists for AmeriFlux and Fluxnet-Canada sites, although we only have the meteorology data for one site.</p>
<p>For other sites you will need to obtain the meteorology data and translate it to a format that the CESM datm model can use.</p>
<p>But, even without meteorology data PTCLMmkdata is useful to setup datasets to run with standard <code class="docutils literal notranslate"><span class="pre">CLM_QIAN</span></code> data.</p>
<p>The original authors of PTCLMmkdata are: Daniel M. Ricciuto, Dali Wang, Peter E. Thornton, Wilfred M. Post all at Environmental Sciences Division, Oak Ridge National Laboratory (ORNL) and R. Quinn Thomas at Cornell University. It was then modified fairly extensively by Erik Kluzek at NCAR. We want to thank all of these individuals for this contribution to the CESM effort. We also want to thank the folks at University of Michigan Biological Stations (US-UMB) who allowed us to use their Fluxnet station data and import it into our inputdata repository, especially Gil Bohrer the PI on record for this site.</p>
</div>
<div class="section" id="details-of-ptclmmkdata">
<span id="details-of-ptclm"></span><h1>1.7.2. Details of PTCLMmkdata<a class="headerlink" href="#details-of-ptclmmkdata" title="Permalink to this headline">¶</a></h1>
<p>To get help on PTCLM2_180611 use the “–help” option as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; cd $CTSMROOT/tools/PTCLM
&gt; ./PTCLMmkdata --help
</pre></div>
</div>
<p>The output to the above command is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> Usage: PTCLM.py [options] -d inputdatadir -m machine -s sitename

 Python script to create cases to run single point simulations with tower site data.

 Options:
    --version             show program&#39;s version number and exit
    -h, --help            show this help message and exit

Required Options:
  -d CCSM_INPUT, --csmdata=CCSM_INPUT
                      Location of CCSM input data
  -m MYMACHINE, --machine=MYMACHINE
                      Machine, valid CESM script machine (-m list to list valid
                      machines)
  -s MYSITE, --site=MYSITE
                      Site-code to run, FLUXNET code or CLM1PT name (-s list to list
                      valid names)

Configure and Run Options:
  -c MYCOMPSET, --compset=MYCOMPSET
                      Compset for CCSM simulation (Must be a valid &#39;I&#39; compset [other
                      than IG compsets], use -c list to list valid compsets)
  --coldstart         Do a coldstart with arbitrary initial conditions
  --caseidprefix=MYCASEID
                      Unique identifier to include as a prefix to the case name
  --cesm_root=BASE_CESM
                      Root CESM directory (top level directory with models and scripts
                      subdirs)
  --debug             Flag to turn on debug mode so won&#39;t run, but display what would
                      happen
  --finidat=FINIDAT   Name of finidat initial conditions file to start CLM from
  --list              List all valid: sites, compsets, and machines
  --namelist=NAMELIST
                      List of namelist items to add to CLM namelist (example:
                      --namelist=&quot;hist_fincl1=&#39;TG&#39;,hist_nhtfrq=-1&quot;
  --QIAN_tower_yrs    Use the QIAN forcing data year that correspond to the tower
                      years
  --rmold             Remove the old case directory before starting
  --run_n=MYRUN_N     Number of time units to run simulation
  --run_units=MYRUN_UNITS
                      Time units to run simulation (steps,days,years, etc.)
  --quiet             Print minimul information on what the script is doing
  --sitegroupname=SITEGROUP
                      Name of the group of sites to search for you selected site in
                      (look for prefix group names in the PTCLM_sitedata directory)
  --stdurbpt          If you want to setup for standard urban namelist settings
  --useQIAN           use QIAN input forcing data instead of tower site meterology data
  --verbose           Print out extra information on what the script is doing

Input data generation options:
  These are options having to do with generation of input datasets.  Note: When
  running for supported CLM1PT single-point datasets you can NOT generate new
  datasets.  For supported CLM1PT single-point datasets, you MUST run with the
  following settings: --nopointdata And you must NOT set any of these: --soilgrid
  --pftgrid --owritesrf

  --nopointdata       Do NOT make point data (use data already created)
  --owritesrf         Overwrite the existing surface datasets if they exist (normally
                      do NOT recreate them)
  --pftgrid           Use pft information from global gridded file (rather than site
                      data)
  --soilgrid          Use soil information from global gridded file (rather than site
                      data)

Main Script Version Id: $Id: PTCLM.py 47576 2013-05-29 19:11:16Z erik $ Scripts URL: $HeadURL: https://svn-ccsm-models.cgd.ucar.edu/PTCLM/trunk_tags/PTCLM1_130529/PTCLM.py $:
</pre></div>
</div>
<p>Here we give a simple example of using PTCLMmkdata for a straightforward case of running at the US-UMB Fluxnet site on cheyenne where we already have the meteorology data on the machine.
Note, see <a class="reference external" href="CLM-URL">the Section called Converting AmeriFlux Data for use by PTCLMmkdata</a> for permission information to use this data.</p>
<div class="section" id="example-6-1-example-of-running-ptclmmkdata-for-us-umb-on-cheyenne">
<h2>1.7.2.1. Example 6-1. Example of running PTCLMmkdata for US-UMB on cheyenne<a class="headerlink" href="#example-6-1-example-of-running-ptclmmkdata-for-us-umb-on-cheyenne" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; setenv CSMDATA   $CESMDATAROOT/inputdata
&gt; setenv MYDATAFILES `pwd`/mydatafiles
&gt; setenv SITE      US-UMB
&gt; setenv MYCASE    testPTCLM

# Next build all of the clm tools you will need
&gt; cd $CTSMROOT/tools/PTCLM
&gt; buildtools
# next run PTCLM (NOTE -- MAKE SURE python IS IN YOUR PATH)
&gt; cd $CTSMROOT/tools/PTCLM
# Here we run it using qcmd so that it will be run on a batch node
&gt; qcmd --  ./PTCLMmkdata --site=$SITE --csmdata=$CSMDATA --mydatadir=$MYDATAFILES &gt;&amp; ptclmrun.log &amp;
&gt; cd $CIMEROOT/scripts
&gt; ./create_newcase --user-mods-dir $MYDATAFILES/1x1pt_$SITE --case $MYCASE --res CLM_USRDAT --compset I1PtClm50SpGs
# Next setup, build and run as normal
&gt; cd $MYCASE
&gt; ./case.setup
</pre></div>
</div>
<p>PTCLMmkdata includes a README file that gives some extra details and a simple example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PTCLM/README                04/10/2015

PTCLMmkdata is a python tool built on top of CLM tools and CESM scripts
for building datasets to run CLM &quot;I&quot; cases for data from Ameriflux Tower-sites,
or other user-supplied single-point datasets.

Original Authors:

Daniel M. Ricciuto, Dali Wang, Peter E. Thornton, Wilfred M. Post

Environmental Sciences Division, Oak Ridge National Laboratory (ORNL)

R. Quinn Thomas

Cornell University

Modified by:

Erik Kluzek (NCAR)

General Directory structure:

  PTCLM/PTCLMmkdata ----- Main script
  PTCLM/PTCLM_sitedata  - Site data files of 
        static information latitude, longitude, soil info., and PFT information 
        for each site Also different &quot;groups&quot; of site-data lists, and the script to
        convert the transient years landuse_timeseries files into landuse_timeseries text files that
        mksurfdata can use.
  PTCLM/mydatafiles ----- Default location of
        data files that will be created by PTCLMmkdata. Sites will be built
        in their own subdirectories under here. Optionally you can give your
        own location you&#39;d like to use for your data.

  PTCLM/PTCLMsublist --------- Script to submit a list of PTCLM
        sites to the batch que (only setup for a few machines).
  PTCLM/PTCLMsublist_prog.py - Python module to support submit
        list script. Handles command line arguments and such.
  PTCLM/batchque.py ---------- Python module for batch submital.
  PTCLM/buildtools ----------- Script to build the CLM
        tools needed to run PTCLMmkdata (mksurfdata_map and gen_domain). Works on yellowstone and cheyenne.

Quickstart:

# ASSUMPTIONS:
# For this example I&#39;m running a I1PtClm50SpGs case on cheyenne using  
# CSMDATA in the standard location
# Finally we use the 6-digit AmeriFlux site code for the University of Mich. Biological
# Station US-UMB (data for this station is checked into the inputdata repository).
# I also assume you are using UNIX C-shell, and GNU make is called gmake
setenv CSMDATA   /glade/p/cesm/cseg/inputdata
setenv SITE      US-UMB


cd PTCLM
setenv MYDATAFILES `pwd`/mydatafiles

# Next build all of the clm tools you will need
# The following script assumes yellowstone, cheyenne, hobart, or edison for other machines
# you&#39;ll need to build each tool by hand
./buildtools
# next run PTCLMsublist which will submit PTCLMmkdata to batch queue (NOTE -- MAKE SURE python, NCO AND NCL IS IN YOUR PATH)
#       PTCLMsublist is only setup for a few batch machines, you&#39;ll need to update them to add new machines
#       or create your own batch submission script.
# NOTE: Every day you run PTCLMmkdata it will remake the map called
#       renamemapfiles to rename files with todays creation date.
#       This makes running PTCLMmkdata a reasonable amount of time.
#       However, you can use the script in mydatafiles
#
./PTCLMsublist -l $SITE -d $CSMDATA --account=XXXXXXXXX --mach=cheyenne

# NOTE: To submit several sites at once, make the &quot;-l&quot; option a comma delimited
#       list of site names.

# Next copy the towersite meterology datafiles into your $MYDATAFILES space
# (For the US-UMB station you can skip this step as the .build step will bring the data over) 
cd $MYDATAFILES/1x1pt_$SITE
mkdir $MYDATAFILES/1x1pt_$SITE/CLM1PT_data
# Copy meteorology data NetCDF files into 1x1pt_$SITE sub-directory 
# (with filenames of yyyy-mm.nc)
# The variables assumed to be on the files are: 
#     ZBOT, TBOT, RH, WIND, PRECTmms, FSDS, PSRF, FLDS
# (if other fields are available or with different names this can be changed by
#  adding a user_nl_datm.streams.txt file as we outline below)
# Make sure your data has time with the attribute: calendar=&quot;gregorian&quot;

# Make sure the forcing directory points to the location of your data
# (PTCLMmkdata should already do this)
./xmlchange DIN_LOC_ROOT_CLMFORC=$MYDATAFILES/1x1pt_$SITE

# Then create a case using the data you just created
setenv MYCASE &quot;testPTCLM&quot;
cd $CTSMROOT/cime
setenv CIMEROOT `pwd`
cd $CIMEROOT/scripts
./create_newcase --user-mods-dir $MYDATAFILES/1x1pt_$SITE --case $MYCASE --res CLM_USRDAT --compset I1PtClm50SpGs --mach cheyenne

# Next setup as normal
cd $MYCASE
./case.setup

# If you need to customize your list of fields uncomment and do the following...
# cp CaseDocs/datm.streams.txt.CLM1PT.CLM_USRDAT user_datm.streams.txt.CLM1PT.CLM_USRDAT
# chmod u+w user_datm.streams.txt.CLM1PT.CLM_USRDAT
# $EDITOR user_datm.streams.txt.CLM1PT.CLM_USRDAT
# ./preview_namelists

# Finally build, and run the case as normal
./case.build
./case.submit
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="using-ptclm.html" title="1.7.3. Using PTCLMmkdata"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="1.7. Running PTCLM"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">clmdoc release-clm5.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >1. clm5.0 User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >1.7. Running PTCLM</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Erik Kluzek, Bill Sacks, Ben Andre.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
  </body>
</html>