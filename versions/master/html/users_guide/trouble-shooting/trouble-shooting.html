

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.8.1. Trouble Shooting &mdash; ctsm CTSM master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ctsm CTSM master documentation" href="../../index.html"/>
        <link rel="up" title="1.8. Troubleshooting" href="index.html"/>
        <link rel="next" title="1.9. Testing" href="../testing/index.html"/>
        <link rel="prev" title="1.8. Troubleshooting" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ctsm
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>CTSM1</option>
                      
                        
                      
                        
                          <option value="">[placeholder]</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">1. CTSM1 User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html">1.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../setting-up-and-running-a-case/index.html">1.2. Setting Up and Running a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-clm-tools/index.html">1.3. Using CLM tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adding-new-resolutions/index.html">1.4. Adding New Resolutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-special-cases/index.html">1.5. Running Special Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-single-points/index.html">1.6. Running Single Point Regional Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-PTCLM/index.html">1.7. Running PTCLM</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">1.8. Troubleshooting</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1.8.1. Trouble Shooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-advice-on-debugging-run-time-problems">1.8.1.1. General Advice on Debugging Run time Problems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../testing/index.html">1.9. Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tech_note/index.html">2. CLM Technical Note</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ctsm</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">1. CTSM1 User’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">1.8. Troubleshooting</a> &raquo;</li>
        
      <li>1.8.1. Trouble Shooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/users_guide/trouble-shooting/trouble-shooting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="trouble-shooting">
<span id="id1"></span><h1>1.8.1. Trouble Shooting<a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we give some guidance on what to do when you encounter some of the most common problems. We can’t cover all the problems that a user could potentially have, but we will try to help you recognize some of the most common situations. And we’ll give you some suggestions on how to approach the problem to come up with a solution.</p>
<p>In general you will run into one of three type of problems:</p>
<ol class="arabic simple">
<li><em>case-creation</em></li>
<li><em>setup-time</em></li>
<li><em>build-time</em></li>
<li><em>run-time</em></li>
</ol>
<p>See the <a class="reference external" href="http://esmci.github.io/cime/users_guide/troubleshooting.html">CIME Trouble Shooting Guide</a> for some help on the first three.</p>
<div class="section" id="general-advice-on-debugging-run-time-problems">
<h2>1.8.1.1. General Advice on Debugging Run time Problems<a class="headerlink" href="#general-advice-on-debugging-run-time-problems" title="Permalink to this headline">¶</a></h2>
<p>Here are some suggestions on how to track down a problem while running. In general if the problem still occurs for a simpler case, it will be easier to track down.</p>
<ol class="arabic simple">
<li><em>Run in DEBUG mode</em></li>
<li><em>Run with a smaller set of processors</em></li>
<li><em>Run in serial mode with a single processor</em></li>
<li><em>Run at a lower resolution</em></li>
<li><em>Run a simpler case</em></li>
<li><em>Run with a debugger</em></li>
</ol>
<div class="section" id="run-in-debug-mode">
<h3>1.8.1.1.1. Run in DEBUG mode<a class="headerlink" href="#run-in-debug-mode" title="Permalink to this headline">¶</a></h3>
<p>The first thing to try is to run in DEBUG mode so that float point trapping will be triggered as well as array bounds checking and other things the compiler can turn on to help you find problems.
To do this edit the <code class="docutils literal notranslate"><span class="pre">env_build.xml</span></code> file and set DEBUG to TRUE as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">DEBUG</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
</div>
<div class="section" id="run-with-a-smaller-set-of-processors">
<h3>1.8.1.1.2. Run with a smaller set of processors<a class="headerlink" href="#run-with-a-smaller-set-of-processors" title="Permalink to this headline">¶</a></h3>
<p>Another way to simplify the system is to run with a smaller set of processors. You will need to clean the setup and edit the –env_mach_pes.xml–. For example, to run with four processors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span> <span class="o">-</span><span class="n">clean</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">NTASKS_ATM</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_LND</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_ICE</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_OCN</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_CPL</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">NTASKS_GLC</span><span class="o">=</span><span class="mi">4</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span>
</pre></div>
</div>
<p>Another recommended simplification is to run without threading, so set the NTHRDS for each component to “1” if it isn’t already. Sometimes, multiprocessing problems require a certain number of processors before they occur so you may not be able to debug the problem without enough processors. But, it’s always good to reduce it to as low a number as possible to make it simpler. For threading problems you may have to have threading enabled to find the problem, but you can run with 1, 2, or 3 threads to see what happens.</p>
</div>
<div class="section" id="run-in-serial-mode-with-a-single-processor">
<h3>1.8.1.1.3. Run in serial mode with a single processor<a class="headerlink" href="#run-in-serial-mode-with-a-single-processor" title="Permalink to this headline">¶</a></h3>
<p>Simplifying to one processor removes all multi-processing problems and makes the case as simple as possible. If you can enable <code class="docutils literal notranslate"><span class="pre">MPILIB=mpi-serial</span></code> you will also be able to run interactively rather than having to submit to a job queue, which sometimes makes it easier to run and debug. If you can use <code class="docutils literal notranslate"><span class="pre">MPILIB=mpi-serial</span></code> you can also use threading, but still run interactively in order to use more processors to make it faster if needed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span> <span class="o">-</span><span class="n">clean</span>
<span class="c1"># Set tasks and threads for each component to 1</span>
<span class="c1"># You could also set threads to something &gt; 1 for speed, but still</span>
<span class="c1"># run interactively if threading isn&#39;t an issue.</span>

<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">NTASKS_ATM</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_ATM</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_LND</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_LND</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_ICE</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_ICE</span><span class="o">=</span><span class="mi">1</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">NTASKS_OCN</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_OCN</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_CPL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_CPL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTASKS_GLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NTHRDS_GLC</span><span class="o">=</span><span class="mi">1</span>
<span class="c1"># set MPILIB to mpi-serial so that you can run interactively</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">MPILIB</span><span class="o">=</span><span class="n">mpi</span><span class="o">-</span><span class="n">serial</span>
<span class="o">&gt;</span> <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">setup</span>
<span class="c1"># Then build your case</span>
<span class="c1"># And finally run, by running the *.run script interactively</span>
</pre></div>
</div>
</div>
<div class="section" id="run-at-a-lower-resolution">
<h3>1.8.1.1.4. Run at a lower resolution<a class="headerlink" href="#run-at-a-lower-resolution" title="Permalink to this headline">¶</a></h3>
<p>If you can create a new case running at a lower resolution and replicate the problem it may be easier to solve. This of course requires creating a whole new case, and trying out different lower resolutions.</p>
</div>
<div class="section" id="run-a-simpler-case">
<h3>1.8.1.1.5. Run a simpler case<a class="headerlink" href="#run-a-simpler-case" title="Permalink to this headline">¶</a></h3>
<p>Along the same lines, you might try running a simpler case, trying another compset with a simpler setup and see if you can replicate the problem and then debug from that simpler case. Again, of course you will need to create new cases to do this.</p>
</div>
<div class="section" id="run-with-a-debugger">
<h3>1.8.1.1.6. Run with a debugger<a class="headerlink" href="#run-with-a-debugger" title="Permalink to this headline">¶</a></h3>
<p>Another suggestion is to run the model with a debugger such as: <strong>ddt</strong>, <strong>dbx</strong>, <strong>gdb</strong>, or <strong>totalview</strong>.
Often to run with a debugger you will need to reduce the number of processors as outlined above.
Some debuggers such as <strong>dbx</strong> will only work with one processor, while more advanced debuggers such as <strong>totalview</strong> can work with both MPI tasks and OMP threads.
Even simple debuggers though can be used to query core files, to see where the code was at when it died (for example using the <strong>where</strong> in <strong>dbx</strong> for a core file can be very helpful.
For help in running with a debugger you will need to contact your system administrators for the machine you are running on.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../testing/index.html" class="btn btn-neutral float-right" title="1.9. Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="1.8. Troubleshooting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, UCAR.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/pop_ver.js"></script>
    

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>